<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Riho admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Riho admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <title>Instructor Dashboard</title>
    <!-- Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="../../css2?family=Montserrat:wght@200;300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/font-awesome.css') }}">
    <!-- ico-font-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/icofont.css') }}">
    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/themify.css') }}">
    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/flag-icon.css') }}">
    <!-- Feather icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/feather-icon.css') }}">
    <!-- Plugins css start-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/slick.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/slick-theme.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/scrollbar.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/animate.css') }}">
    <!-- Plugins css Ends-->
    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/bootstrap.css') }}">
    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link id="color" rel="stylesheet" href="{{ url_for('static', filename='css/color-1.css') }}" media="screen">
    <!-- Responsive css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/responsive.css') }}">
  </head>
  <body> 
    <!-- loader starts-->
    <div class="loader-wrapper">
      <div class="loader"> 
        <div class="loader4"></div>
      </div>
    </div>
    <!-- loader ends-->
    <!-- tap on top starts-->
    <div class="tap-top"><i data-feather="chevrons-up"></i></div>
    <!-- tap on tap ends-->
    <!-- page-wrapper Start-->
    <div class="page-wrapper compact-wrapper" id="pageWrapper">
      <!-- Page Header Start-->
      <div class="page-header">
        <div class="header-wrapper row m-0">
          <form class="form-inline search-full col" action="#" method="get">
            <div class="form-group w-100">
              <div class="Typeahead Typeahead--twitterUsers">
                <div class="u-posRelative"> 
                  <input class="demo-input Typeahead-input form-control-plaintext w-100" type="text" placeholder="Search Riho .." name="q" title="" autofocus="">
                  <div class="spinner-border Typeahead-spinner" role="status"><span class="sr-only">Loading... </span></div><i class="close-search" data-feather="x"></i>
                </div>
                <div class="Typeahead-menu"> </div>
              </div>
            </div>
          </form>
          <div class="header-logo-wrapper col-auto p-0">  
            <div class="logo-wrapper"> <a href="index.html"><img class="img-fluid for-light" src="{{ url_for('static', filename='images/logo/logo_dark.png') }}" alt="logo-light"><img class="img-fluid for-dark" src="{{ url_for('static', filename='images/logo/logo.png') }}" alt="logo-dark"></a></div>
            <div class="toggle-sidebar"> <i class="status_toggle middle sidebar-toggle" data-feather="align-center"></i></div>
          </div>
          <div class="left-header col-xxl-5 col-xl-6 col-lg-5 col-md-4 col-sm-3 p-0">
            <div> <a class="toggle-sidebar" href="#"> <i class="iconly-Category icli"> </i></a>
              <div class="d-flex align-items-center gap-2 ">
                <h4 class="f-w-600">{{ user_name }}</h4>
                <img class="mt-0" src="{{ url_for('static', filename='images/hand.gif') }}" alt="hand-gif">
              </div>
            </div>
            <div class="welcome-content d-xl-block d-none"><span class="text-truncate col-12">Here's what's happening with your course today. </span></div>
          </div>
          <div class="nav-right col-xxl-7 col-xl-6 col-md-7 col-8 pull-right right-header p-0 ms-auto">
            <ul class="nav-menus"> 
              <li class="d-md-block d-none"> 
                <div class="form search-form mb-0">
                  <div class="input-group"><span class="input-icon">
                      <svg>
                        <use href="{{ url_for('static', filename='svg/icon-sprite.svg#search-header') }}"></use>
                      </svg>
                      <input class="w-100" type="search" placeholder="Search"></span></div>
                </div>
              </li>
              <li class="d-md-none d-block"> 
                <div class="form search-form mb-0">
                  <div class="input-group"> <span class="input-show"> 
                      <svg id="searchIcon">
                        <use href="{{ url_for('static', filename='svg/icon-sprite.svg#search-header') }}"></use>
                      </svg>
                      <div id="searchInput">
                        <input type="search" placeholder="Search">
                      </div></span></div>
                </div>
              </li>
              <li class="profile-nav onhover-dropdown"> 
                <div class="media profile-media">
                    <img class="b-r-10" alt="">
                    <div class="media-body d-xxl-block d-none box-col-none">
                        <p class="mb-0 font-roboto">Instructor <i class="middle fa fa-angle-down"></i></p>
                    </div>
                </div>
                <ul class="profile-dropdown onhover-show-div">
                    <li><a href="#" id="myProfileLink"><i data-feather="user"></i><span>My Profile</span></a></li>
                    <li><a href="{{ url_for('auth.logout') }}"><i data-feather="log-out"></i><span>Log out</span></a></li>
                </ul>
              </li>
            </ul>
          </div>
          <script class="result-template" type="text/x-handlebars-template">
            <div class="ProfileCard u-cf">                        
            <div class="ProfileCard-avatar"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-airplay m-0"><path d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"></path><polygon points="12 15 17 21 7 21 12 15"></polygon></svg></div>
            <div class="ProfileCard-details"> 
            <div class="ProfileCard-realName">{{name}}</div>
            </div> 
            </div>
          </script>
          <script class="empty-template" type="text/x-handlebars-template"><div class="EmptyMessage">Your search turned up 0 results. This most likely means the backend is down, yikes!</div></script>
        </div>
      </div>
      <!-- Page Header Ends                               -->
      <!-- Page Body Start-->
      <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div class="sidebar-wrapper" data-layout="stroke-svg">
          <div class="logo-wrapper"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/1.png') }}" alt=""></a>
            <div class="back-btn"><i class="fa fa-angle-left"> </i></div>
            <div class="toggle-sidebar"><i class="status_toggle middle sidebar-toggle" data-feather="grid"> </i></div>
          </div>
          <div class="logo-icon-wrapper"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/logo-icon.png') }}" alt=""></a></div>
          <nav class="sidebar-main">
            <div class="left-arrow" id="left-arrow"><i data-feather="arrow-left"></i></div>
            <div id="sidebar-menu">
              <ul class="sidebar-links" id="simple-bar">
                <li class="back-btn">
                    <a href="index.html"><img class="img-fluid" src="#" alt=""></a>
                    <div class="mobile-back text-end"> <span>Back </span><i class="fa fa-angle-right ps-2" aria-hidden="true"></i></div>
                </li>
                <li class="sidebar-list">
                    <i class="fa fa-thumb-tack"></i>
                    <a class="sidebar-link sidebar-title" href="#">
                        <span>Course</span>
                    </a>
                    <ul class="sidebar-submenu">
                        <li>
                            <a href="#" id="addedCoursesTab" data-toggle="modal" data-target="#addedCourseModal">Added Courses</a>
                        </li>
                    </ul>
                </li>
                <li class="sidebar-list">
                    <a class="sidebar-link sidebar-title" href="#">
                        <svg class="stroke-icon">
                            <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-task') }}"></use>
                        </svg>
                        <span>Quizzes</span>
                    </a>
                    <ul class="sidebar-submenu">
                        <li><a href="#" id="createQuizLink">Create Quiz</a></li>
                        <li><a href="#" id="viewQuizzesLink">View Quizzes</a></li>
                    </ul>
                </li>
              </ul>
              <div class="right-arrow" id="right-arrow"><i data-feather="arrow-right"></i></div>
            </div>
          </nav>
        </div>
        <!-- Page Sidebar Ends-->
        <div class="page-body">
          <div class="container-fluid">
            <div class="page-title">
              <div class="row">
                <div class="col-6">
                  <h4>Instructor Dashboard</h4>
                </div>
                <div class="col-6">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">                                       
                        <svg class="stroke-icon">
                          <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-home') }}"></use>
                        </svg></a></li>
                    <li class="breadcrumb-item">Course</li>
                    
                  </ol>
                </div>
              </div>
            </div>
          </div>
          <!-- Container-fluid starts-->
          <div class="container-fluid"> 
            <div class="row">
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-header">
                    <h4>Add Course </h4>
                    <p class="mt-1 f-m-light"></p>
                  </div>
                  <div class="card-body">
                    <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#addCourseModal">Add New Course</button>
                    <div class="modal fade" id="addCourseModal" tabindex="-1" role="dialog" aria-labelledby="addCourseModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="addCourseModalLabel">Add New Course</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            <form id="addCourseForm" novalidate>
                              <div class="mb-3">
                                <label for="courseName" class="form-label">Course Name</label>
                                <input type="text" class="form-control" id="courseName" required 
                                       placeholder="Enter course name" minlength="3" maxlength="50">
                                <div class="invalid-feedback">
                                    Course name must be between 3 and 50 characters
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseDescription" class="form-label">Course Description</label>
                                <textarea class="form-control" id="courseDescription" rows="3" required
                                        placeholder="Enter course description" minlength="10" maxlength="500"></textarea>
                                <div class="invalid-feedback">
                                    Description must be between 10 and 500 characters
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseLevel" class="form-label">Course Level</label>
                                <select class="form-control" id="courseLevel" required>
                                    <option value="">Select Level</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a course level
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseDuration" class="form-label">Course Duration</label>
                                <input type="text" class="form-control" id="courseDuration" required
                                       placeholder="e.g., 2 weeks, 30 hours">
                                <div class="invalid-feedback">
                                    Please enter a valid duration (e.g., 2 weeks, 30 hours)
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseLink" class="form-label">Course Link</label>
                                <input type="url" class="form-control" id="courseLink" required
                                       placeholder="Enter course link">
                                <div class="invalid-feedback">
                                    Please enter a valid URL
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseStatus" class="form-label">Status</label>
                                <select class="form-control" id="courseStatus" required>
                                    <option value="">Select Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a status
                                </div>
                              </div>
                            </form>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="saveCourse">Save Course</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
                <div class="col-xl-3 col-md-6">
                    <div class="card stat-card">
                        <div class="card-body">
                            <h5>Total Courses</h5>
                            <h2 id="totalCourses">0</h2>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6">
                    <div class="card stat-card">
                        <div class="card-body">
                            <h5>Active Courses</h5>
                            <h2 id="activeCourses">0</h2>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6">
                    <div class="card stat-card">
                        <div class="card-body">
                            <h5>Total Students</h5>
                            <h2 id="totalStudents">0</h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h4>Student Progress</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Course</th>
                                    <th>Progress</th>
                                    <th>Last Active</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="studentProgressList">
                                <!-- Populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4>Course Announcements</h4>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newAnnouncementModal">
                        <i class="fa fa-plus"></i> New Announcement
                    </button>
                </div>
                <div class="card-body">
                    <div id="announcementsList" class="announcement-list">
                        <!-- Announcements will be loaded here -->
                    </div>
                </div>
            </div>
            <!-- Add this where you want the quizzes section to appear -->
            <div id="quizzesSection" class="container-fluid" style="display: none;">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h4>Course Quizzes</h4>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addQuizModal">
                                    <i class="fa fa-plus"></i> Create New Quiz
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="quizzesList" class="quiz-list">
                                    <!-- Quizzes will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
                </div>
            </div>
          </div>
          <!-- Container-fluid Ends-->
        </div>
        <!-- footer start-->
        <footer class="footer">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-12 footer-copyright text-center">
                <p class="mb-0">Copyright 2024 © DCEE </p>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <!-- latest jquery-->
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <!-- Bootstrap js-->
    <script src="{{ url_for('static', filename='js/bootstrap/bootstrap.bundle.min.js') }}"></script>
    <!-- feather icon js-->
    <script src="{{ url_for('static', filename='js/icons/feather-icon/feather.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/icons/feather-icon/feather-icon.js') }}"></script>
    <!-- scrollbar js-->
    <script src="{{ url_for('static', filename='js/scrollbar/simplebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/scrollbar/custom.js') }}"></script>
    <!-- Sidebar jquery-->
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
    <!-- Plugins JS start-->
    <script src="{{ url_for('static', filename='js/sidebar-menu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar-pin.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick/slick.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick/slick.js') }}"></script>
    <script src="{{ url_for('static', filename='js/header-slick.js') }}"></script>
    <!-- calendar js-->
    <script src="{{ url_for('static', filename='js/height-equal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tooltip-init.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modalpage/validation-modal.js') }}"></script>
    <!-- Plugins JS Ends-->
    <!-- Theme js-->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme-customizer/customizer.js') }}"></script>
    <!-- Added Courses Modal -->
    <div class="modal fade" id="addedCourseModal" tabindex="-1" role="dialog" aria-labelledby="addedCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addedCourseModalLabel">Added Courses</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Description</th>
                                <th>Level</th>
                                <th>Duration</th>
                                <th>Course Link</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="addedCoursesList">
                            <!-- Courses will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            // Predefined valid course categories/keywords
            const validCourseKeywords = [
                'marketing', 'digital marketing', 'e commerce', 'web development', 
                'python', 'java', 'javascript', 'react', 'angular', 'vue', 
                'node', 'php', 'html', 'css', 'bootstrap', 'jquery', 
                'mongodb', 'mysql', 'postgresql', 'database', 'cloud computing',
                'aws', 'azure', 'google cloud', 'devops', 'machine learning',
                'artificial intelligence', 'data science', 'blockchain',
                'cyber security', 'networking', 'business', 'management',
                'finance', 'accounting', 'human resources', 'sales'
            ];

            function validateInput(input, validator, errorMsg) {
                const value = input.val().trim();
                const isValid = validator(value);
                input.toggleClass('is-invalid', !isValid);
                input.toggleClass('is-valid', isValid);
                input.siblings('.invalid-feedback').text(errorMsg);
                return isValid;
            }

            // Course name validation
            function isValidCourseName(name) {
                name = name.toLowerCase();
                return validCourseKeywords.some(keyword => 
                    name.includes(keyword) || 
                    keyword.includes(name)
                );
            }

            // Description validation - simplified
            function isValidDescription(description) {
                // Only check for minimum length and proper sentence structure
                return description.length >= 20 && 
                       /^[A-Z].*[.!?]$/.test(description);
            }

            // Real-time validation
            $('#courseName').on('input', function() {
                validateInput($(this), 
                    isValidCourseName,
                    'Please enter a valid course name (e.g., Web Development, Digital Marketing, Python Programming)'
                );
            });

            $('#courseDescription').on('input', function() {
                validateInput($(this), 
                    isValidDescription,
                    'Description must be at least 20 characters, start with a capital letter, and end with proper punctuation.'
                );
            });

            // Form submission validation
            $('#saveCourse').on('click', function() {
                const form = $('#addCourseForm')[0];
                form.classList.add('was-validated');

                const name = $('#courseName').val().trim();
                const description = $('#courseDescription').val().trim();
                const level = $('#courseLevel').val();
                const duration = $('#courseDuration').val().trim();
                const course_link = $('#courseLink').val().trim();
                const status = $('#courseStatus').val();

                // Validate all fields
                let isValid = true;
                isValid &= validateInput($('#courseName'), 
                    isValidCourseName,
                    'Invalid course name'
                );
                isValid &= validateInput($('#courseDescription'), 
                    isValidDescription,
                    'Invalid description'
                );
                isValid &= validateInput($('#courseDuration'), 
                    value => /^[0-9]+\s*(hours?|days?|weeks?|months?)$/i.test(value), 
                    'Invalid duration'
                );
                isValid &= validateInput($('#courseLink'), 
                    value => /^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\/?$/.test(value), 
                    'Invalid URL'
                );
                isValid &= !!level;
                isValid &= !!status;

                if (!isValid) {
                    return;
                }

                // Submit form if validation passes
                const courseData = {
                    name: name,
                    description: description,
                    level: level,
                    duration: duration,
                    course_link: course_link,
                    status: status
                };

                $.ajax({
                    url: "{{ url_for('instructor.add_course') }}",
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(courseData),
                    success: function(response) {
                        if (response.success) {
                            alert('Course added successfully');
                            $('#addCourseModal').modal('hide');
                            form.reset();
                            form.classList.remove('was-validated');
                            $('.form-control').removeClass('is-valid is-invalid');
                            loadCourses();
                        } else {
                            alert('Failed to add course: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while adding the course');
                    }
                });
            });

            // Reset form when modal is closed
            $('#addCourseModal').on('hidden.bs.modal', function() {
                const form = $('#addCourseForm')[0];
                form.reset();
                form.classList.remove('was-validated');
                $('.form-control').removeClass('is-valid is-invalid');
            });

            function loadCourses() {
                $.ajax({
                    url: "{{ url_for('instructor.get_courses') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#addedCoursesList').empty();
                            response.data.forEach(course => {
                                $('#addedCoursesList').append(`
                                    <tr>
                                        <td>${course.name}</td>
                                        <td>${course.description}</td>
                                        <td>${course.level}</td>
                                        <td>${course.duration}</td>
                                        <td><a href="${course.course_link}" target="_blank">View Course</a></td>
                                        <td>${course.status}</td>
                                    </tr>
                                `);
                            });
                        } else {
                            alert('Failed to fetch courses: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while fetching courses');
                    }
                });
            }

            // Load courses when clicking Added Courses tab
            $('#addedCoursesTab').on('click', function() {
                loadCourses();
                $('#addedCourseModal').modal('show');
            });

            function loadProfileData() {
                $.ajax({
                    url: "{{ url_for('instructor.get_profile') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#instructorName').val(response.data.name);
                            $('#instructorEmail').val(response.data.email);
                            $('#profileModal').modal('show');
                        } else {
                            alert('Failed to fetch profile data: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                        alert('An error occurred while fetching profile data');
                    }
                });
            }

            $('#myProfileLink').on('click', function(e) {
                e.preventDefault();
                loadProfileData();
            });

            function editCourse(courseId) {
                $.ajax({
                    url: `/instructor/course/${courseId}`,
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            // Populate edit modal with course data
                            $('#editCourseName').val(response.data.name);
                            $('#editCourseDescription').val(response.data.description);
                            $('#editCourseLevel').val(response.data.level);
                            $('#editCourseDuration').val(response.data.duration);
                            $('#editCourseLink').val(response.data.course_link);
                            $('#editCourseStatus').val(response.data.status);
                            $('#editCourseModal').modal('show');
                        }
                    }
                });
            }

            function deleteCourse(courseId) {
                if(confirm('Are you sure you want to delete this course?')) {
                    $.ajax({
                        url: `/instructor/course/${courseId}`,
                        type: 'DELETE',
                        success: function(response) {
                            if(response.success) {
                                alert('Course deleted successfully');
                                loadCourses();
                            }
                        }
                    });
                }
            }

            // Load instructor's courses into the announcement course dropdown
            function loadCoursesForAnnouncement() {
                $.ajax({
                    url: "{{ url_for('instructor.get_courses') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#announcementCourse').empty();
                            $('#announcementCourse').append('<option value="">Select Course</option>');
                            response.data.forEach(course => {
                                $('#announcementCourse').append(
                                    `<option value="${course._id}">${course.name}</option>`
                                );
                            });
                        }
                    }
                });
            }

            // Load all announcements
            function loadAnnouncements() {
                $.ajax({
                    url: "{{ url_for('instructor.get_announcements') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#announcementsList').empty();
                            response.data.forEach(announcement => {
                                $('#announcementsList').append(`
                                    <div class="announcement-item mb-4">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-1">${announcement.title}</h5>
                                            <small class="text-muted">${new Date(announcement.created_at).toLocaleDateString()}</small>
                                        </div>
                                        <p class="mb-1">${announcement.message}</p>
                                        <small class="text-muted">Course: ${announcement.course_name}</small>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-danger" onclick="deleteAnnouncement('${announcement._id}')">
                                                <i class="fa fa-trash"></i> Delete
                                            </button>
                                        </div>
                                    </div>
                                    <hr>
                                `);
                            });
                        }
                    }
                });
            }

            // Save new announcement
            $('#saveAnnouncement').click(function() {
                const courseId = $('#announcementCourse').val();
                const title = $('#announcementTitle').val().trim();
                const message = $('#announcementMessage').val().trim();

                if (!courseId || !title || !message) {
                    alert('Please fill in all fields');
                    return;
                }

                $.ajax({
                    url: "{{ url_for('instructor.add_announcement') }}",
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        course_id: courseId,
                        title: title,
                        message: message
                    }),
                    success: function(response) {
                        if (response.success) {
                            alert('Announcement posted successfully');
                            $('#newAnnouncementModal').modal('hide');
                            $('#announcementForm')[0].reset();
                            loadAnnouncements();
                        } else {
                            alert('Failed to post announcement: ' + response.message);
                        }
                    }
                });
            });

            // Delete announcement
            window.deleteAnnouncement = function(announcementId) {
                if (confirm('Are you sure you want to delete this announcement?')) {
                    $.ajax({
                        url: `/instructor/announcement/${announcementId}`,
                        type: 'DELETE',
                        success: function(response) {
                            if (response.success) {
                                alert('Announcement deleted successfully');
                                loadAnnouncements();
                            }
                        }
                    });
                }
            }

            // Load courses when modal opens
            $('#newAnnouncementModal').on('show.bs.modal', function() {
                loadCoursesForAnnouncement();
            });

            // Initial load of announcements
            loadAnnouncements();

            // Add this to your existing $(document).ready function
            $('#createQuizLink').click(function(e) {
                e.preventDefault();
                $('#addQuizModal').modal('show');
            });

            $('#viewQuizzesLink').click(function(e) {
                e.preventDefault();
                loadQuizzes();
                $('#viewQuizzesModal').modal('show');
            });
        });
    </script>
    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profileModalLabel">Instructor Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="mb-3">
                            <label for="instructorName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="instructorName" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="instructorEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="instructorEmail" readonly>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="uploadMaterialsModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Course Materials</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="materialUploadForm">
                        <div class="mb-3">
                            <label class="form-label">Select Course</label>
                            <select class="form-control" id="courseSelect" required>
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Material Type</label>
                            <select class="form-control" id="materialType" required>
                                <option value="video">Video</option>
                                <option value="document">Document</option>
                                <option value="assignment">Assignment</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Upload File</label>
                            <input type="file" class="form-control" id="materialFile" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="uploadMaterial">Upload</button>
                </div>
            </div>
        </div>
    </div>
    <!-- New Announcement Modal -->
    <div class="modal fade" id="newAnnouncementModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="announcementForm">
                        <div class="mb-3">
                            <label class="form-label">Select Course</label>
                            <select class="form-control" id="announcementCourse" required>
                                <!-- Courses will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" id="announcementTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Message</label>
                            <textarea class="form-control" id="announcementMessage" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveAnnouncement">Post Announcement</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Quiz Modal -->
    <div class="modal fade" id="addQuizModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Quiz</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fa fa-info-circle"></i>
                        Please add minimum 3 and maximum 10 questions.
                    </div>
                    <form id="quizForm">
                        <div class="mb-3">
                            <label class="form-label">Select Course</label>
                            <select class="form-control" id="quizCourse" required>
                                <!-- Courses will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quiz Title</label>
                            <input type="text" class="form-control" id="quizTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quiz Description</label>
                            <textarea class="form-control" id="quizDescription" rows="2" required></textarea>
                        </div>
                        <div id="questionsList">
                            <!-- Questions will be added here -->
                        </div>
                        <button type="button" class="btn btn-info mt-3" id="addQuestion">
                            <i class="fa fa-plus"></i> Add Question
                        </button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveQuiz">Save Quiz</button>
                </div>
            </div>
        </div>
    </div>
    <!-- View Quizzes Modal -->
    <div class="modal fade" id="viewQuizzesModal" tabindex="-1" aria-labelledby="viewQuizzesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewQuizzesModalLabel">View Quizzes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Description</th>
                                    <th>Course</th>
                                    <th>Questions</th>
                                    <th>Created Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="quizzesList">
                                <!-- Quizzes will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <style>
    .announcement-list {
        max-height: 500px;
        overflow-y: auto;
    }

    .announcement-item {
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: transform 0.2s;
    }

    .announcement-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .quiz-list {
        max-height: 60vh;
        overflow-y: auto;
    }

    .quiz-item {
        transition: transform 0.2s;
    }

    .quiz-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .question-container {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
    }

    .modal-lg {
        max-width: 90%;
    }

    .badge {
        font-size: 0.9em;
        padding: 0.5em 1em;
    }

    .table td {
        vertical-align: middle;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .modal-backdrop {
        z-index: 1040;
    }

    .modal {
        z-index: 1050;
    }

    .table tbody tr:hover {
        background-color: #f8f9fa;
    }

    .btn-group {
        display: flex;
        gap: 5px;
    }
    </style>
    <script>
    $(document).ready(function() {
        let questionCount = 0;
        const MIN_QUESTIONS = 3;
        const MAX_QUESTIONS = 10;

        // Load courses for quiz dropdown
        function loadCoursesForQuiz() {
            $.ajax({
                url: "{{ url_for('instructor.get_courses') }}",
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        $('#quizCourse').empty();
                        $('#quizCourse').append('<option value="">Select Course</option>');
                        response.data.forEach(course => {
                            $('#quizCourse').append(
                                `<option value="${course._id}">${course.name}</option>`
                            );
                        });
                    }
                }
            });
        }

        // Update Add Question button
        $('#addQuestion').click(function() {
            if (questionCount >= MAX_QUESTIONS) {
                alert(`Maximum ${MAX_QUESTIONS} questions allowed`);
                return;
            }
            questionCount++;
            const questionHtml = `
                <div class="question-container mb-4" id="question${questionCount}">
                    <hr>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6>Question ${questionCount}</h6>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeQuestion(${questionCount})">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Question Text</label>
                        <input type="text" class="form-control question-text" required>
                    </div>
                    <div class="options-container">
                        <div class="mb-2">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="correct${questionCount}" required>
                                </div>
                                <input type="text" class="form-control option-text" placeholder="Option 1" required>
                            </div>
                        </div>
                        <div class="mb-2">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="correct${questionCount}" required>
                                </div>
                                <input type="text" class="form-control option-text" placeholder="Option 2" required>
                            </div>
                        </div>
                        <div class="mb-2">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="correct${questionCount}" required>
                                </div>
                                <input type="text" class="form-control option-text" placeholder="Option 3" required>
                            </div>
                        </div>
                        <div class="mb-2">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="correct${questionCount}" required>
                                </div>
                                <input type="text" class="form-control option-text" placeholder="Option 4" required>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            $('#questionsList').append(questionHtml);
            // Disable add button if max reached
            if (questionCount >= MAX_QUESTIONS) {
                $('#addQuestion').prop('disabled', true);
            }
        });

        // Update Save Quiz validation
        $('#saveQuiz').click(function() {
            const courseId = $('#quizCourse').val();
            const title = $('#quizTitle').val().trim();
            const description = $('#quizDescription').val().trim();

            // Basic validation
            if (!courseId || !title || !description) {
                alert('Please fill in all quiz details');
                return;
            }

            // Collect and validate questions
            const questions = [];
            let isValid = true;

            $('.question-container').each(function() {
                const questionText = $(this).find('.question-text').val().trim();
                const options = [];
                let correctAnswer = null;

                // Validate question text
                if (!questionText) {
                    alert('Please fill in all question texts');
                    isValid = false;
                    return false; // break the loop
                }

                // Validate options
                $(this).find('.input-group').each(function(index) {
                    const optionText = $(this).find('.option-text').val().trim();
                    if (!optionText) {
                        alert('Please fill in all options');
                        isValid = false;
                        return false; // break the loop
                    }
                    options.push(optionText);
                    if ($(this).find('input[type="radio"]').is(':checked')) {
                        correctAnswer = index;
                    }
                });

                // Validate correct answer selection
                if (correctAnswer === null) {
                    alert('Please select a correct answer for each question');
                    isValid = false;
                    return false; // break the loop
                }

                questions.push({
                    question: questionText,
                    options: options,
                    correct_answer: correctAnswer
                });
            });

            // Check minimum questions requirement
            if (questions.length < MIN_QUESTIONS) {
                alert(`Please add at least ${MIN_QUESTIONS} questions`);
                return;
            }

            // If all validations pass, save the quiz
            if (isValid) {
                const quizData = {
                    course_id: courseId,
                    title: title,
                    description: description,
                    questions: questions
                };

                $.ajax({
                    url: "{{ url_for('instructor.add_quiz') }}",
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(quizData),
                    success: function(response) {
                        if (response.success) {
                            alert('Quiz created successfully');
                            $('#addQuizModal').modal('hide');
                            $('#quizForm')[0].reset();
                            $('#questionsList').empty();
                            questionCount = 0;
                            loadQuizzes();
                            $('#viewQuizzesModal').modal('show');
                        } else {
                            alert('Failed to create quiz: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while creating the quiz');
                    }
                });
            }
        });

        // Update remove question function
        window.removeQuestion = function(questionId) {
            $(`#question${questionId}`).remove();
            questionCount--;
            // Re-enable add button if below max
            if (questionCount < MAX_QUESTIONS) {
                $('#addQuestion').prop('disabled', false);
            }
        };

        // Reset quiz modal when closed
        $('#addQuizModal').on('hidden.bs.modal', function() {
            const form = $('#quizForm')[0];
            form.reset();
            $('#questionsList').empty();
            questionCount = 0;
            $('#addQuestion').prop('disabled', false);
        });

        // Initialize the modal
        const viewQuizzesModal = new bootstrap.Modal(document.getElementById('viewQuizzesModal'));

        // Handle View Quizzes click
        $(document).on('click', '#viewQuizzesLink', function(e) {
            e.preventDefault();
            console.log('View Quizzes clicked'); // Debug log
            loadQuizzes();
            viewQuizzesModal.show();
        });

        // Function to load quizzes
        function loadQuizzes() {
            $.ajax({
                url: "{{ url_for('instructor.get_quizzes') }}",
                type: 'GET',
                success: function(response) {
                    console.log('Quizzes response:', response); // Debug log
                    if (response.success) {
                        $('#quizzesList').empty();
                        if (response.data.length === 0) {
                            $('#quizzesList').append(`
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <p class="my-3">No quizzes created yet</p>
                                    </td>
                                </tr>
                            `);
                        } else {
                            response.data.forEach(quiz => {
                                $('#quizzesList').append(`
                                    <tr>
                                        <td><strong>${quiz.title}</strong></td>
                                        <td>${quiz.description}</td>
                                        <td>${quiz.course_name}</td>
                                        <td><span class="badge bg-primary">${quiz.question_count} Questions</span></td>
                                        <td>${new Date(quiz.created_at).toLocaleDateString()}</td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" onclick="deleteQuiz('${quiz._id}')">
                                                <i class="fa fa-trash"></i> Delete
                                            </button>
                                        </td>
                                    </tr>
                                `);
                            });
                        }
                    } else {
                        console.error('Failed to load quizzes:', response.message);
                        alert('Failed to load quizzes: ' + response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Ajax error:', error);
                    alert('An error occurred while loading quizzes');
                }
            });
        }

        // Delete quiz
        window.deleteQuiz = function(quizId) {
            if (confirm('Are you sure you want to delete this quiz?')) {
                $.ajax({
                    url: `/instructor/quiz/${quizId}`,
                    type: 'DELETE',
                    success: function(response) {
                        if (response.success) {
                            alert('Quiz deleted successfully');
                            loadQuizzes();
                        } else {
                            alert('Failed to delete quiz: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while deleting the quiz');
                    }
                });
            }
        };

        // Load courses when modal opens
        $('#addQuizModal').on('show.bs.modal', function() {
            loadCoursesForQuiz();
        });

        // Initial load of quizzes
        loadQuizzes();
    });
    </script>
  </body>
</html>