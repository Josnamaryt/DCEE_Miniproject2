<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Riho admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Riho admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <title>Instructor Dashboard</title>
    <!-- Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="../../css2?family=Montserrat:wght@200;300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/font-awesome.css') }}">
    <!-- ico-font-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/icofont.css') }}">
    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/themify.css') }}">
    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/flag-icon.css') }}">
    <!-- Feather icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/feather-icon.css') }}">
    <!-- Plugins css start-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/slick.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/slick-theme.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/scrollbar.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/animate.css') }}">
    <!-- Plugins css Ends-->
    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/bootstrap.css') }}">
    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link id="color" rel="stylesheet" href="{{ url_for('static', filename='css/color-1.css') }}" media="screen">
    <!-- Responsive css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/responsive.css') }}">
  </head>
  <body> 
    <!-- loader starts-->
    <div class="loader-wrapper">
      <div class="loader"> 
        <div class="loader4"></div>
      </div>
    </div>
    <!-- loader ends-->
    <!-- tap on top starts-->
    <div class="tap-top"><i data-feather="chevrons-up"></i></div>
    <!-- tap on tap ends-->
    <!-- page-wrapper Start-->
    <div class="page-wrapper compact-wrapper" id="pageWrapper">
      <!-- Page Header Start-->
      <div class="page-header">
        <div class="header-wrapper row m-0">
          <form class="form-inline search-full col" action="#" method="get">
            <div class="form-group w-100">
              <div class="Typeahead Typeahead--twitterUsers">
                <div class="u-posRelative"> 
                  <input class="demo-input Typeahead-input form-control-plaintext w-100" type="text" placeholder="Search Riho .." name="q" title="" autofocus="">
                  <div class="spinner-border Typeahead-spinner" role="status"><span class="sr-only">Loading... </span></div><i class="close-search" data-feather="x"></i>
                </div>
                <div class="Typeahead-menu"> </div>
              </div>
            </div>
          </form>
          <div class="header-logo-wrapper col-auto p-0">  
            <div class="logo-wrapper"> <a href="index.html"><img class="img-fluid for-light" src="{{ url_for('static', filename='images/logo/logo_dark.png') }}" alt="logo-light"><img class="img-fluid for-dark" src="{{ url_for('static', filename='images/logo/logo.png') }}" alt="logo-dark"></a></div>
            <div class="toggle-sidebar"> <i class="status_toggle middle sidebar-toggle" data-feather="align-center"></i></div>
          </div>
          <div class="left-header col-xxl-5 col-xl-6 col-lg-5 col-md-4 col-sm-3 p-0">
            <div> <a class="toggle-sidebar" href="#"> <i class="iconly-Category icli"> </i></a>
              <div class="d-flex align-items-center gap-2 ">
                <h4 class="f-w-600">{{ user_name }}</h4>
                <img class="mt-0" src="{{ url_for('static', filename='images/hand.gif') }}" alt="hand-gif">
              </div>
            </div>
            <div class="welcome-content d-xl-block d-none"><span class="text-truncate col-12">Here's what's happening with your course today. </span></div>
          </div>
          <div class="nav-right col-xxl-7 col-xl-6 col-md-7 col-8 pull-right right-header p-0 ms-auto">
            <ul class="nav-menus"> 
              <li class="d-md-block d-none"> 
                <div class="form search-form mb-0">
                  <div class="input-group"><span class="input-icon">
                      <svg>
                        <use href="{{ url_for('static', filename='svg/icon-sprite.svg#search-header') }}"></use>
                      </svg>
                      <!-- <input class="w-100" type="search" placeholder="Search"></span></div> -->
                </div>
              </li>
              <li class="d-md-none d-block"> 
                <div class="form search-form mb-0">
                  <div class="input-group"> <span class="input-show"> 
                      <svg id="searchIcon">
                        <use href="{{ url_for('static', filename='svg/icon-sprite.svg#search-header') }}"></use>
                      </svg>
                      <div id="searchInput">
                        <input type="search" placeholder="Search">
                      </div></span></div>
                </div>
              </li>
              <li class="profile-nav onhover-dropdown"> 
                <div class="media profile-media">
                    <img class="b-r-10" alt="">
                    <div class="media-body d-xxl-block d-none box-col-none">
                        <p class="mb-0 font-roboto">Instructor <i class="middle fa fa-angle-down"></i></p>
                    </div>
                </div>
                <ul class="profile-dropdown onhover-show-div">
                    <li><a href="#" id="myProfileLink"><i data-feather="user"></i><span>My Profile</span></a></li>
                    <li><a href="{{ url_for('auth.logout') }}"><i data-feather="log-out"></i><span>Log out</span></a></li>
                </ul>
              </li>
            </ul>
          </div>
          <script class="result-template" type="text/x-handlebars-template">
            <div class="ProfileCard u-cf">                        
            <div class="ProfileCard-avatar"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-airplay m-0"><path d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"></path><polygon points="12 15 17 21 7 21 12 15"></polygon></svg></div>
            <div class="ProfileCard-details"> 
            <div class="ProfileCard-realName">{{name}}</div>
            </div> 
            </div>
          </script>
          <script class="empty-template" type="text/x-handlebars-template"><div class="EmptyMessage">Your search turned up 0 results. This most likely means the backend is down, yikes!</div></script>
        </div>
      </div>
      <!-- Page Header Ends                               -->
      <!-- Page Body Start-->
      <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div class="sidebar-wrapper" data-layout="stroke-svg">
          <div class="logo-wrapper"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/1.png') }}" alt=""></a>
            <div class="back-btn"><i class="fa fa-angle-left"> </i></div>
            <div class="toggle-sidebar"><i class="status_toggle middle sidebar-toggle" data-feather="grid"> </i></div>
          </div>
          <div class="logo-icon-wrapper"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/logo-icon.png') }}" alt=""></a></div>
          <nav class="sidebar-main">
            <div class="left-arrow" id="left-arrow"><i data-feather="arrow-left"></i></div>
            <div id="sidebar-menu">
              <ul class="sidebar-links" id="simple-bar">
                <li class="back-btn">
                    <a href="index.html"><img class="img-fluid" src="#" alt=""></a>
                    <div class="mobile-back text-end"> <span>Back </span><i class="fa fa-angle-right ps-2" aria-hidden="true"></i></div>
                </li>
                <li class="sidebar-list">
                    <i class="fa fa-thumb-tack"></i>
                    <a class="sidebar-link sidebar-title" href="#">
                        <span>Course</span>
                    </a>
                    <ul class="sidebar-submenu">
                        <li>
                            <a href="#" id="addedCoursesTab" data-toggle="modal" data-target="#addedCourseModal">Added Courses</a>
                        </li>
                    </ul>
                </li>
                <li class="sidebar-list">
                    <a class="sidebar-link sidebar-title" href="#">
                        <svg class="stroke-icon">
                            <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-task') }}"></use>
                        </svg>
                        <span>Quizzes</span>
                    </a>
                    <ul class="sidebar-submenu">
                        <li><a href="#" id="createQuizLink">Create Quiz</a></li>
                        <!-- <li><a href="#" id="viewQuizzesLink">View Quizzes</a></li> -->
                    </ul>
                </li>
                <li class="sidebar-list">
                    <a class="sidebar-link sidebar-title" href="#">
                        <svg class="stroke-icon">
                            <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-chart') }}"></use>
                        </svg>
                        <span>Quiz Results</span>
                    </a>
                    <ul class="sidebar-submenu">
                        <li><a href="#" id="viewQuizResultsLink">View Results</a></li>
                    </ul>
                </li>
              </ul>
              <div class="right-arrow" id="right-arrow"><i data-feather="arrow-right"></i></div>
            </div>
          </nav>
        </div>
        <!-- Page Sidebar Ends-->
        <div class="page-body">
          <div class="container-fluid">
            <div class="page-title">
              <div class="row">
                <div class="col-6">
                  <h4>Instructor Dashboard</h4>
                </div>
                <div class="col-6">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">                                       
                        <svg class="stroke-icon">
                          <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-home') }}"></use>
                        </svg></a></li>
                    <li class="breadcrumb-item">Course</li>
                    
                  </ol>
                </div>
              </div>
            </div>
          </div>
          <!-- Container-fluid starts-->
          <div class="container-fluid"> 
            <div class="row">
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-header">
                    <h4>Add Course </h4>
                    <p class="mt-1 f-m-light"></p>
                  </div>
                  <div class="card-body">
                    <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#addCourseModal">Add New Course</button>
                    <div class="modal fade" id="addCourseModal" tabindex="-1" role="dialog" aria-labelledby="addCourseModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="addCourseModalLabel">Add New Course</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            <form id="addCourseForm" novalidate>
                              <div class="mb-3">
                                <label for="courseName" class="form-label">Course Name</label>
                                <input type="text" class="form-control" id="courseName" required 
                                       placeholder="Enter course name" minlength="3" maxlength="50">
                                <div id="courseNameFeedback" class="feedback"></div>
                                <div class="invalid-feedback">Please enter a valid course name</div>
                              </div>
                              <div class="mb-3">
                                <label for="courseDescription" class="form-label">Course Description</label>
                                <textarea class="form-control" id="courseDescription" rows="3" required
                                        placeholder="Enter course description" minlength="10" maxlength="500"></textarea>
                                <div class="invalid-feedback">
                                    Description must be between 10 and 500 characters
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseLevel" class="form-label">Course Level</label>
                                <select class="form-control" id="courseLevel" required>
                                    <option value="">Select Level</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a course level
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseDuration" class="form-label">Course Duration</label>
                                <input type="text" class="form-control" id="courseDuration" required
                                       placeholder="e.g., 2 weeks, 30 hours">
                                <div class="invalid-feedback">
                                    Please enter a valid duration (e.g., 2 weeks, 30 hours)
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseLink" class="form-label">Course Link</label>
                                <input type="url" class="form-control" id="courseLink" required
                                       placeholder="Enter course link">
                                <div class="invalid-feedback">
                                    Please enter a valid URL
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseStatus" class="form-label">Status</label>
                                <select class="form-control" id="courseStatus" required>
                                    <option value="">Select Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a status
                                </div>
                              </div>
                            </form>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="saveCourse">Save Course</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4>Course Announcements</h4>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newAnnouncementModal">
                        <i class="fa fa-plus"></i> New Announcement
                    </button>
                </div>
                <div class="card-body">
                    <div id="announcementsList" class="announcement-list">
                        <!-- Announcements will be loaded here -->
                    </div>
                </div>
            </div>
            <!-- Add this where you want the quizzes section to appear -->
            <div id="quizzesSection" class="container-fluid" style="display: none;">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h4>Course Quizzes</h4>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addQuizModal">
                                    <i class="fa fa-plus"></i> Create New Quiz
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="quizzesList" class="quiz-list">
                                    <!-- Quizzes will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
                </div>
            </div>
          </div>
          <!-- Container-fluid Ends-->
        </div>
        <!-- footer start-->
        <footer class="footer">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-12 footer-copyright text-center">
                <p class="mb-0">Copyright 2024 © DCEE </p>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <!-- latest jquery-->
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <!-- Bootstrap js-->
    <script src="{{ url_for('static', filename='js/bootstrap/bootstrap.bundle.min.js') }}"></script>
    <!-- feather icon js-->
    <script src="{{ url_for('static', filename='js/icons/feather-icon/feather.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/icons/feather-icon/feather-icon.js') }}"></script>
    <!-- scrollbar js-->
    <script src="{{ url_for('static', filename='js/scrollbar/simplebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/scrollbar/custom.js') }}"></script>
    <!-- Sidebar jquery-->
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
    <!-- Plugins JS start-->
    <script src="{{ url_for('static', filename='js/sidebar-menu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar-pin.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick/slick.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick/slick.js') }}"></script>
    <script src="{{ url_for('static', filename='js/header-slick.js') }}"></script>
    <!-- calendar js-->
    <script src="{{ url_for('static', filename='js/height-equal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tooltip-init.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modalpage/validation-modal.js') }}"></script>
    <!-- Plugins JS Ends-->
    <!-- Theme js-->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme-customizer/customizer.js') }}"></script>
    <!-- Added Courses Modal -->
    <div class="modal fade" id="addedCourseModal" tabindex="-1" role="dialog" aria-labelledby="addedCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addedCourseModalLabel">Added Courses</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Description</th>
                                <th>Level</th>
                                <th>Duration</th>
                                <th>Course Link</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="addedCoursesList">
                            <!-- Courses will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            // Initialize all modals
            const quizResultsModal = new bootstrap.Modal(document.getElementById('quizResultsModal'));
            const viewQuizzesModal = new bootstrap.Modal(document.getElementById('viewQuizzesModal'));
            const attemptDetailModal = new bootstrap.Modal(document.getElementById('attemptDetailModal'));

            // Handle View Results click from sidebar
            $('#viewQuizResultsLink').on('click', function(e) {
                e.preventDefault();
                loadQuizTitles(); // Load quiz titles when the modal opens
                $('#quizResultsModal').modal('show');
            });

            // Predefined valid course categories/keywords
            const validCourseKeywords = [
                'marketing', 'digital marketing', 'e commerce', 'web development', 
                'python', 'java', 'javascript', 'react', 'angular', 'vue', 
                'node', 'php', 'html', 'css', 'bootstrap', 'jquery', 
                'mongodb', 'mysql', 'postgresql', 'database', 'cloud computing',
                'aws', 'azure', 'google cloud', 'devops', 'machine learning',
                'artificial intelligence', 'data science', 'blockchain',
                'cyber security', 'networking', 'business', 'management',
                'finance', 'accounting', 'human resources', 'sales'
            ];

            function validateInput(input, validator, errorMsg) {
                const value = input.val().trim();
                const isValid = validator(value);
                input.toggleClass('is-invalid', !isValid);
                input.toggleClass('is-valid', isValid);
                input.siblings('.invalid-feedback').text(errorMsg);
                return isValid;
            }

            // Course name validation
            function isValidCourseName(name) {
                name = name.toLowerCase();
                return validCourseKeywords.some(keyword => 
                    name.includes(keyword) || 
                    keyword.includes(name)
                );
            }

            // Description validation - simplified
            function isValidDescription(description) {
                // Only check for minimum length and proper sentence structure
                return description.length >= 20 && 
                       /^[A-Z].*[.!?]$/.test(description);
            }

            // Real-time validation
            $('#courseName').on('input', function() {
                validateInput($(this), 
                    isValidCourseName,
                    'Please enter a valid course name (e.g., Web Development, Digital Marketing, Python Programming)'
                );
            });

            $('#courseDescription').on('input', function() {
                validateInput($(this), 
                    isValidDescription,
                    'Description must be at least 20 characters, start with a capital letter, and end with proper punctuation.'
                );
            });

            // Add a debounce function to limit API calls
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // Function to check course name
            const checkCourseName = debounce(function(courseName) {
                if (!courseName) {
                    $('#courseNameFeedback').html('').removeClass('valid-feedback invalid-feedback');
                    return;
                }

                $.ajax({
                    url: "{{ url_for('instructor.check_course_name') }}",
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ name: courseName }),
                    success: function(response) {
                        if (response.success) {
                            if (response.exists) {
                                $('#courseName').removeClass('is-valid').addClass('is-invalid');
                                $('#courseNameFeedback')
                                    .html('This course name already exists')
                                    .removeClass('valid-feedback')
                                    .addClass('invalid-feedback')
                                    .show();
                            } else {
                                $('#courseName').removeClass('is-invalid').addClass('is-valid');
                                $('#courseNameFeedback')
                                    .html('Course name is available')
                                    .removeClass('invalid-feedback')
                                    .addClass('valid-feedback')
                                    .show();
                            }
                        }
                    },
                    error: function() {
                        $('#courseNameFeedback')
                            .html('Error checking course name')
                            .removeClass('valid-feedback')
                            .addClass('invalid-feedback')
                            .show();
                    }
                });
            }, 500); // 500ms delay

            // Update the course name input event handler
            $('#courseName').on('input', function() {
                const courseName = $(this).val().trim();
                checkCourseName(courseName);
            });

            // Update the save course button click handler
            $('#saveCourse').on('click', function() {
                const form = $('#addCourseForm')[0];
                form.classList.add('was-validated');

                const name = $('#courseName').val().trim();
                const description = $('#courseDescription').val().trim();
                const level = $('#courseLevel').val();
                const duration = $('#courseDuration').val().trim();
                const course_link = $('#courseLink').val().trim();
                const status = $('#courseStatus').val();

                // Validate all fields
                if (!name || !description || !level || !duration || !course_link || !status) {
                    alert('Please fill in all required fields');
                    return;
                }

                // Check if course name is invalid or already exists
                if ($('#courseName').hasClass('is-invalid')) {
                    const feedback = $('#courseNameFeedback').text();
                    alert(feedback || 'Please choose a different course name');
                    return;
                }

                // Submit form if validation passes
                const courseData = {
                    name: name,
                    description: description,
                    level: level,
                    duration: duration,
                    course_link: course_link,
                    status: status
                };

                $.ajax({
                    url: "{{ url_for('instructor.add_course') }}",
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(courseData),
                    success: function(response) {
                        if (response.success) {
                            alert('Course added successfully');
                            $('#addCourseModal').modal('hide');
                            form.reset();
                            form.classList.remove('was-validated');
                            $('.form-control').removeClass('is-valid is-invalid');
                            loadCourses();
                        } else {
                            alert('Failed to add course: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while adding the course');
                    }
                });
            });

            // Reset form when modal is closed
            $('#addCourseModal').on('hidden.bs.modal', function() {
                const form = $('#addCourseForm')[0];
                form.reset();
                form.classList.remove('was-validated');
                $('.form-control').removeClass('is-valid is-invalid');
            });

            function loadCourses() {
                $.ajax({
                    url: "{{ url_for('instructor.get_courses') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#addedCoursesList').empty();
                            response.data.forEach(course => {
                                $('#addedCoursesList').append(`
                                    <tr>
                                        <td>${course.name}</td>
                                        <td>${course.description}</td>
                                        <td>${course.level}</td>
                                        <td>${course.duration}</td>
                                        <td><a href="${course.course_link}" target="_blank">View Course</a></td>
                                        <td>${course.status}</td>
                                    </tr>
                                `);
                            });
                        } else {
                            alert('Failed to fetch courses: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while fetching courses');
                    }
                });
            }

            // Load courses when clicking Added Courses tab
            $('#addedCoursesTab').on('click', function() {
                loadCourses();
                $('#addedCourseModal').modal('show');
            });

            function loadProfileData() {
                $.ajax({
                    url: "{{ url_for('instructor.get_profile') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#instructorName').val(response.data.name);
                            $('#instructorEmail').val(response.data.email);
                            $('#profileModal').modal('show');
                        } else {
                            alert('Failed to fetch profile data: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                        alert('An error occurred while fetching profile data');
                    }
                });
            }

            $('#myProfileLink').on('click', function(e) {
                e.preventDefault();
                loadProfileData();
            });

            function editCourse(courseId) {
                $.ajax({
                    url: `/instructor/course/${courseId}`,
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            // Populate edit modal with course data
                            $('#editCourseName').val(response.data.name);
                            $('#editCourseDescription').val(response.data.description);
                            $('#editCourseLevel').val(response.data.level);
                            $('#editCourseDuration').val(response.data.duration);
                            $('#editCourseLink').val(response.data.course_link);
                            $('#editCourseStatus').val(response.data.status);
                            $('#editCourseModal').modal('show');
                        }
                    }
                });
            }

            function deleteCourse(courseId) {
                if(confirm('Are you sure you want to delete this course?')) {
                    $.ajax({
                        url: `/instructor/course/${courseId}`,
                        type: 'DELETE',
                        success: function(response) {
                            if(response.success) {
                                alert('Course deleted successfully');
                                loadCourses();
                            }
                        }
                    });
                }
            }

            // Load instructor's courses into the announcement course dropdown
            function loadCoursesForAnnouncement() {
                $.ajax({
                    url: "{{ url_for('instructor.get_courses') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#announcementCourse').empty();
                            $('#announcementCourse').append('<option value="">Select Course</option>');
                            response.data.forEach(course => {
                                $('#announcementCourse').append(
                                    `<option value="${course._id}">${course.name}</option>`
                                );
                            });
                        }
                    }
                });
            }

            // Load all announcements
            function loadAnnouncements() {
                $.ajax({
                    url: "{{ url_for('instructor.get_announcements') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#announcementsList').empty();
                            response.data.forEach(announcement => {
                                $('#announcementsList').append(`
                                    <div class="announcement-item mb-4">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-1">${announcement.title}</h5>
                                            <small class="text-muted">${new Date(announcement.created_at).toLocaleDateString()}</small>
                                        </div>
                                        <p class="mb-1">${announcement.message}</p>
                                        <small class="text-muted">Course: ${announcement.course_name}</small>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-danger" onclick="deleteAnnouncement('${announcement._id}')">
                                                <i class="fa fa-trash"></i> Delete
                                            </button>
                                        </div>
                                    </div>
                                    <hr>
                                `);
                            });
                        }
                    }
                });
            }

            // Save new announcement
            $('#saveAnnouncement').click(function() {
                const courseId = $('#announcementCourse').val();
                const title = $('#announcementTitle').val().trim();
                const message = $('#announcementMessage').val().trim();

                if (!courseId || !title || !message) {
                    alert('Please fill in all fields');
                    return;
                }

                $.ajax({
                    url: "{{ url_for('instructor.add_announcement') }}",
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        course_id: courseId,
                        title: title,
                        message: message
                    }),
                    success: function(response) {
                        if (response.success) {
                            alert('Announcement posted successfully');
                            $('#newAnnouncementModal').modal('hide');
                            $('#announcementForm')[0].reset();
                            loadAnnouncements();
                        } else {
                            alert('Failed to post announcement: ' + response.message);
                        }
                    }
                });
            });

            // Delete announcement
            window.deleteAnnouncement = function(announcementId) {
                if (confirm('Are you sure you want to delete this announcement?')) {
                    $.ajax({
                        url: `/instructor/announcement/${announcementId}`,
                        type: 'DELETE',
                        success: function(response) {
                            if (response.success) {
                                alert('Announcement deleted successfully');
                                loadAnnouncements();
                            }
                        }
                    });
                }
            }

            // Load courses when modal opens
            $('#newAnnouncementModal').on('show.bs.modal', function() {
                loadCoursesForAnnouncement();
            });

            // Initial load of announcements
            loadAnnouncements();

            // Add this to your existing $(document).ready function
            $('#createQuizLink').click(function(e) {
                e.preventDefault();
                $('#addQuizModal').modal('show');
            });

            $('#viewQuizzesLink').click(function(e) {
                e.preventDefault();
                loadQuizzes();
            });

            // Add this to your existing $(document).ready function
            $('#uploadQuestions').click(function() {
                $('#excelUploadSection').toggle();
            });

            // Update the Excel processing and course loading functionality
            $('#addQuizModal').on('show.bs.modal', function() {
                loadCoursesForQuiz();
            });

            // Update the Excel processing function
            $('#processExcel').click(function() {
                const fileInput = $('#excelFile')[0];
                if (!fileInput.files.length) {
                    alert('Please select an Excel file');
                    return;
                }

                const formData = new FormData();
                formData.append('file', fileInput.files[0]);

                // First ensure courses are loaded
                loadCoursesForQuiz();

                $.ajax({
                    url: "{{ url_for('instructor.process_quiz_excel') }}",
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        if (response.success) {
                            // Clear existing questions
                            $('#questionsList').empty();
                            questionCount = 0;

                            // Add questions from Excel
                            response.data.forEach(question => {
                                questionCount++;
                                const questionHtml = generateQuestionHtml(
                                    questionCount,
                                    question.question,
                                    question.options,
                                    question.correct_answer
                                );
                                $('#questionsList').append(questionHtml);
                            });
                        } else {
                            alert('Error processing Excel: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('Error uploading file');
                    }
                });
            });

            // Function to load courses for quiz
            function loadCoursesForQuiz() {
                $.ajax({
                    url: "{{ url_for('instructor.get_courses') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#quizCourse').empty();
                            $('#quizCourse').append('<option value="">Select Course</option>');
                            response.data.forEach(course => {
                                $('#quizCourse').append(
                                    `<option value="${course._id}">${course.name}</option>`
                                );
                            });
                        } else {
                            console.error('Failed to load courses:', response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading courses:', error);
                    }
                });
            }

            function generateQuestionHtml(number, questionText, options, correctAnswer) {
                let optionsHtml = '';
                options.forEach((option, index) => {
                    optionsHtml += `
                        <div class="mb-2">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="correct${number}" ${index === correctAnswer ? 'checked' : ''} required>
                                </div>
                                <input type="text" class="form-control option-text" value="${option}" required>
                            </div>
                        </div>`;
                });

                return `
                    <div class="question-container mb-4" id="question${number}">
                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6>Question ${number}</h6>
                            <button type="button" class="btn btn-danger btn-sm" onclick="removeQuestion(${number})">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Question Text</label>
                            <input type="text" class="form-control question-text" value="${questionText}" required>
                        </div>
                        <div class="options-container">
                            ${optionsHtml}
                        </div>
                    </div>`;
            }

            // Update the view quizzes functionality
            $('#viewQuizzesLink').click(function(e) {
                e.preventDefault();
                loadQuizzes();
            });

            // Function to load quizzes
            function loadQuizzes() {
                console.log('loadQuizzes function called'); // Debug log
                
                // Show loading indicator
                $('#quizzesList').html(`
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                `);
                
                // Debug: Log the URL being called
                const quizzesUrl = "{{ url_for('instructor.get_quizzes') }}";
                console.log('Fetching quizzes from:', quizzesUrl);
                
                $.ajax({
                    url: quizzesUrl,
                    type: 'GET',
                    success: function(response) {
                        console.log('Server response:', response); // Debug log
                        $('#quizzesList').empty();
                        
                        if (response.success && response.data && response.data.length > 0) {
                            console.log(`Found ${response.data.length} quizzes`); // Debug log
                            response.data.forEach(quiz => {
                                console.log('Processing quiz:', quiz); // Debug log
                                const createdDate = new Date(quiz.created_at).toLocaleDateString();
                                const questionCount = quiz.questions ? quiz.questions.length : 0;
                                
                                const quizHtml = `
                                    <tr>
                                        <td><strong>${quiz.title || 'N/A'}</strong></td>
                                        <td><span class="text-wrap">${quiz.description || 'N/A'}</span></td>
                                        <td>${quiz.course_name || 'N/A'}</td>
                                        <td><span class="badge bg-primary">${questionCount} Questions</span></td>
                                        <td>${createdDate}</td>
                                        <td>
                                            <div class="btn-group">
                                                <button class="btn btn-info btn-sm" onclick="viewQuizResults('${quiz._id}')">
                                                    <i class="fa fa-chart-bar"></i> Results
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteQuiz('${quiz._id}')">
                                                    <i class="fa fa-trash"></i> Delete
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                                console.log('Adding quiz HTML:', quizHtml); // Debug log
                                $('#quizzesList').append(quizHtml);
                            });
                        } else {
                            console.log('No quizzes found or invalid response'); // Debug log
                            $('#quizzesList').html(`
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="alert alert-info mb-0">
                                            <i class="fa fa-info-circle"></i> No quizzes found
                                        </div>
                                    </td>
                                </tr>
                            `);
                        }
                        
                        // Show the modal
                        console.log('Showing modal'); // Debug log
                        $('#viewQuizzesModal').modal('show');
                    },
                    error: function(xhr, status, error) {
                        console.error('Ajax error:', {
                            status: xhr.status,
                            statusText: xhr.statusText,
                            responseText: xhr.responseText,
                            error: error
                        }); // Detailed error log
                        
                        if (xhr.status === 401) {
                            console.log('User not authenticated, redirecting to login'); // Debug log
                            window.location.href = "{{ url_for('auth.login') }}";
                        } else {
                            $('#quizzesList').html(`
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="alert alert-danger mb-0">
                                            <i class="fa fa-exclamation-circle"></i> Error loading quizzes: ${error}
                                        </div>
                                    </td>
                                </tr>
                            `);
                        }
                    }
                });
            }

            // Delete quiz function
            window.deleteQuiz = function(quizId) {
                if (confirm('Are you sure you want to delete this quiz?')) {
                    $.ajax({
                        url: `/instructor/quiz/${quizId}`,
                        type: 'DELETE',
                        success: function(response) {
                            if (response.success) {
                                alert('Quiz deleted successfully');
                                loadQuizzes(); // Reload the quizzes list
                            } else {
                                alert('Failed to delete quiz: ' + response.message);
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('Delete quiz error:', error);
                            alert('An error occurred while deleting the quiz');
                        }
                    });
                }
            };

            // View quiz results function
            window.viewQuizResults = function(quizId) {
                loadQuizTitles(); // Load all quiz titles first
                setTimeout(() => {
                    $('#quizSelector').val(quizId); // Select the specific quiz
                    $('#quizSelector').trigger('change'); // Trigger the change event to load results
                }, 500);
                $('#viewQuizzesModal').modal('hide');
                $('#quizResultsModal').modal('show');
            };

            // Add this function to load quiz titles into the selector
            function loadQuizTitles() {
                // Show loading state in the selector
                $('#quizSelector').html('<option value="">Loading quizzes...</option>');
                
                $.ajax({
                    url: "{{ url_for('instructor.get_quizzes') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success && response.data) {
                            $('#quizSelector').empty();
                            $('#quizSelector').append('<option value="">Select Quiz</option>');
                            
                            response.data.forEach(quiz => {
                                $('#quizSelector').append(`
                                    <option value="${quiz._id}">
                                        ${quiz.title} - ${quiz.course_name}
                                    </option>
                                `);
                            });
                        } else {
                            $('#quizSelector').html(`
                                <option value="">No quizzes available</option>
                            `);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading quizzes:', error);
                        $('#quizSelector').html(`
                            <option value="">Error loading quizzes</option>
                        `);
                    }
                });
            }

            // Update the quiz selector change handler to use the correct field names
            $('#quizSelector').on('change', function() {
                const quizId = $(this).val();
                if (!quizId) {
                    $('#quizResultsBody').html(`
                        <tr>
                            <td colspan="6" class="text-center">
                                <div class="alert alert-info">
                                    <i class="fa fa-info-circle"></i> Please select a quiz to view results
                                </div>
                            </td>
                        </tr>
                    `);
                    return;
                }

                // Show loading state
                $('#quizResultsBody').html(`
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Loading results...</span>
                            </div>
                        </td>
                    </tr>
                `);

                // Fetch quiz attempts with updated field names
                $.ajax({
                    url: `/instructor/quiz/${quizId}/attempts`,
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#quizResultsBody').empty();
                            
                            if (response.data.length === 0) {
                                $('#quizResultsBody').html(`
                                    <tr>
                                        <td colspan="6" class="text-center">
                                            <div class="alert alert-info">
                                                <i class="fa fa-info-circle"></i> No attempts found for this quiz
                                            </div>
                                        </td>
                                    </tr>
                                `);
                                return;
                            }

                            response.data.forEach(attempt => {
                                const submittedDate = new Date(attempt.submitted_at).toLocaleString();
                                $('#quizResultsBody').append(`
                                    <tr>
                                        <td>${attempt.user_name || 'N/A'}</td>
                                        <td>${attempt.user_email || 'N/A'}</td>
                                        <td>${attempt.score}%</td>
                                        <td>${attempt.total_questions}</td>
                                        <td>${submittedDate}</td>
                                        <td>
                                            <button class="btn btn-info btn-sm" onclick="viewAttemptDetails('${attempt._id}')">
                                                <i class="fa fa-eye"></i> View Details
                                            </button>
                                        </td>
                                    </tr>
                                `);
                            });
                        } else {
                            $('#quizResultsBody').html(`
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="alert alert-danger">
                                            <i class="fa fa-exclamation-circle"></i> Error loading results: ${response.message}
                                        </div>
                                    </td>
                                </tr>
                            `);
                        }
                    },
                    error: function(xhr, status, error) {
                        $('#quizResultsBody').html(`
                            <tr>
                                <td colspan="6" class="text-center">
                                    <div class="alert alert-danger">
                                        <i class="fa fa-exclamation-circle"></i> Error loading results: ${error}
                                    </div>
                                </td>
                            </tr>
                        `);
                    }
                });
            });

            // Update the view attempt details function to use the correct field names
            window.viewAttemptDetails = function(attemptId) {
                $.ajax({
                    url: `/instructor/attempt/${attemptId}`,
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            const attempt = response.data;
                            
                            // Update student info with correct field names
                            $('#detailStudentName').text(attempt.user_name || 'N/A');
                            $('#detailStudentEmail').text(attempt.user_email || 'N/A');
                            $('#detailScore').text(`${attempt.score}%`);
                            
                            // Clear previous question details
                            $('#questionDetails').empty();
                            
                            // Add each question and its details
                            attempt.questions.forEach((question, index) => {
                                const studentAnswer = question.student_answer;
                                const correctAnswer = question.correct_answer;
                                
                                let optionsHtml = '';
                                question.options.forEach((option, optionIndex) => {
                                    const isCorrect = optionIndex === correctAnswer;
                                    const isStudentAnswer = optionIndex === studentAnswer;
                                    const optionClass = isCorrect ? 'correct-answer' : (isStudentAnswer ? 'student-answer' : '');
                                    
                                    optionsHtml += `
                                        <div class="option ${optionClass}">
                                            ${option}
                                            ${isCorrect ? '<span class="text-success ms-2">(Correct Answer)</span>' : ''}
                                            ${isStudentAnswer ? '<span class="text-primary ms-2">(Student\'s Answer)</span>' : ''}
                                        </div>
                                    `;
                                });
                                
                                $('#questionDetails').append(`
                                    <div class="question-detail mb-4">
                                        <h6 class="mb-3">Question ${index + 1}</h6>
                                        <p class="mb-3">${question.question}</p>
                                        <div class="options-list">
                                            ${optionsHtml}
                                        </div>
                                    </div>
                                `);
                            });
                            
                            // Show the modal
                            $('#attemptDetailModal').modal('show');
                        } else {
                            alert('Error loading attempt details: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert('Error loading attempt details: ' + error);
                    }
                });
            };
        });
    </script>
    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profileModalLabel">Instructor Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="mb-3">
                            <label for="instructorName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="instructorName" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="instructorEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="instructorEmail" readonly>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="uploadMaterialsModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Course Materials</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="materialUploadForm">
                        <div class="mb-3">
                            <label class="form-label">Select Course</label>
                            <select class="form-control" id="courseSelect" required>
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Material Type</label>
                            <select class="form-control" id="materialType" required>
                                <option value="video">Video</option>
                                <option value="document">Document</option>
                                <option value="assignment">Assignment</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Upload File</label>
                            <input type="file" class="form-control" id="materialFile" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="uploadMaterial">Upload</button>
                </div>
            </div>
        </div>
    </div>
    <!-- New Announcement Modal -->
    <div class="modal fade" id="newAnnouncementModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="announcementForm">
                        <div class="mb-3">
                            <label class="form-label">Select Course</label>
                            <select class="form-control" id="announcementCourse" required>
                                <!-- Courses will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" id="announcementTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Message</label>
                            <textarea class="form-control" id="announcementMessage" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveAnnouncement">Post Announcement</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Quiz Modal -->
    <div class="modal fade" id="addQuizModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Quiz</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fa fa-info-circle"></i>
                        Please add minimum 3 and maximum 10 questions.
                    </div>
                    <div class="d-flex gap-2 mt-3">
                        <button type="button" class="btn btn-info" id="addQuestion">
                            <i class="fa fa-plus"></i> Add Question
                        </button>
                        <button type="button" class="btn btn-success" id="uploadQuestions">
                            <i class="fa fa-file-excel"></i> Upload Questions (Excel)
                        </button>
                    </div>
                    <div class="mt-3" id="excelUploadSection" style="display: none;">
                        <div class="alert alert-info">
                            <i class="fa fa-info-circle"></i>
                            <strong>Excel Format:</strong> Please use the following columns: Question, Option1, Option2, Option3, Option4, CorrectAnswer(1-4)
                            <a href="{{ url_for('instructor.download_template') }}" class="btn btn-sm btn-outline-primary ms-2">
                                <i class="fa fa-download"></i> Download Template
                            </a>
                        </div>
                        <div class="input-group">
                            <input type="file" class="form-control" id="excelFile" accept=".xlsx,.xls">
                            <button class="btn btn-primary" type="button" id="processExcel">
                                <i class="fa fa-upload"></i> Process File
                            </button>
                        </div>
                    </div>
                    <form id="quizForm">
                        <div class="mb-3">
                            <label class="form-label">Select Course</label>
                            <select class="form-control" id="quizCourse" required>
                                <!-- Courses will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quiz Title</label>
                            <input type="text" class="form-control" id="quizTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quiz Description</label>
                            <textarea class="form-control" id="quizDescription" rows="2" required></textarea>
                        </div>
                        <div id="questionsList">
                            <!-- Questions will be added here -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveQuiz">Save Quiz</button>
                </div>
            </div>
        </div>
    </div>
    <!-- View Quizzes Modal -->
    <div class="modal fade" id="viewQuizzesModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">View Quizzes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th style="width: 20%">Title</th>
                                    <th style="width: 25%">Description</th>
                                    <th style="width: 15%">Course</th>
                                    <th style="width: 15%">Questions</th>
                                    <th style="width: 15%">Created Date</th>
                                    <th style="width: 10%">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="quizzesList">
                                <!-- Quizzes will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Quiz Results Modal -->
    <div class="modal fade" id="quizResultsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Quiz Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="quizSelector" class="form-label">Select Quiz</label>
                            <select class="form-select" id="quizSelector">
                                <option value="">Select Quiz</option>
                            </select>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Email</th>
                                    <th>Score</th>
                                    <th>Total Questions</th>
                                    <th>Attempt Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="quizResultsBody">
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="alert alert-info">
                                            <i class="fa fa-info-circle"></i> Please select a quiz to view results
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
        </div>
    </div>

    <!-- Detailed Attempt Modal -->
    <div class="modal fade" id="attemptDetailModal" tabindex="-1" aria-labelledby="attemptDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="attemptDetailModalLabel">Attempt Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="student-info mb-4">
                        <h6>Student Information</h6>
                        <p><strong>Name:</strong> <span id="detailStudentName"></span></p>
                        <p><strong>Email:</strong> <span id="detailStudentEmail"></span></p>
                        <p><strong>Score:</strong> <span id="detailScore"></span></p>
                    </div>
                    <div class="attempt-details">
                        <h6>Question Details</h6>
                        <div id="questionDetails">
                            <!-- Question details will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <style>
    .announcement-list {
        max-height: 500px;
        overflow-y: auto;
    }

    .announcement-item {
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: transform 0.2s;
    }

    .announcement-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .quiz-list {
        max-height: 60vh;
        overflow-y: auto;
    }

    .quiz-item {
        transition: transform 0.2s;
    }

    .quiz-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .question-container {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
    }

    .modal-lg {
        max-width: 90%;
    }

    .badge {
        font-size: 0.9em;
        padding: 0.5em 1em;
    }

    .table td {
        vertical-align: middle;
        padding: 12px;
    }

    .text-wrap {
        white-space: normal;
        max-width: 300px;
        display: -webkit-box;
        display: block;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        max-height: 3em;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .modal-xl {
        max-width: 95%;
    }

    .btn-group {
        gap: 5px;
    }

    .modal-backdrop {
        z-index: 1040;
    }

    .modal {
        z-index: 1050;
    }

    .table tbody tr:hover {
        background-color: #f8f9fa;
    }

        .options-list {
            margin-top: 10px;
        }
        
        .option {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            background-color: #f8f9fa;
        }

        .correct-answer {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .student-answer {
            border: 2px solid #007bff;
        }

        .question-detail {
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 15px;
        }

        .question-detail:last-child {
            border-bottom: none;
        }

    .feedback {
        display: none;
        margin-top: 0.25rem;
        font-size: 0.875em;
    }

    .form-control.is-loading {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Cpath d='M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z'/%3E%3Cpath fill='%23000' d='M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0C22.32,8.481,24.301,9.057,26.013,10.047z'%3E%3CanimateTransform attributeType='xml' attributeName='transform' type='rotate' from='0 20 20' to='360 20 20' dur='0.5s' repeatCount='indefinite'/%3E%3C/path%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }

    .valid-feedback {
        color: #198754;
    }

    .invalid-feedback {
        color: #dc3545;
    }

    .text-info {
        color: #0dcaf0;
    }
    </style>
  </body>
</html>