<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Riho admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Riho admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <title>Instructor Dashboard</title>
    <!-- Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="../../css2?family=Montserrat:wght@200;300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/font-awesome.css') }}">
    <!-- ico-font-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/icofont.css') }}">
    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/themify.css') }}">
    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/flag-icon.css') }}">
    <!-- Feather icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/feather-icon.css') }}">
    <!-- Plugins css start-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/slick.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/slick-theme.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/scrollbar.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/animate.css') }}">
    <!-- Plugins css Ends-->
    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/bootstrap.css') }}">
    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link id="color" rel="stylesheet" href="{{ url_for('static', filename='css/color-1.css') }}" media="screen">
    <!-- Responsive css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/responsive.css') }}">
  </head>
  <body> 
    <!-- loader starts-->
    <div class="loader-wrapper">
      <div class="loader"> 
        <div class="loader4"></div>
      </div>
    </div>
    <!-- loader ends-->
    <!-- tap on top starts-->
    <div class="tap-top"><i data-feather="chevrons-up"></i></div>
    <!-- tap on tap ends-->
    <!-- page-wrapper Start-->
    <div class="page-wrapper compact-wrapper" id="pageWrapper">
      <!-- Page Header Start-->
      <div class="page-header">
        <div class="header-wrapper row m-0">
          <form class="form-inline search-full col" action="#" method="get">
            <div class="form-group w-100">
              <div class="Typeahead Typeahead--twitterUsers">
                <div class="u-posRelative"> 
                  <input class="demo-input Typeahead-input form-control-plaintext w-100" type="text" placeholder="Search Riho .." name="q" title="" autofocus="">
                  <div class="spinner-border Typeahead-spinner" role="status"><span class="sr-only">Loading... </span></div><i class="close-search" data-feather="x"></i>
                </div>
                <div class="Typeahead-menu"> </div>
              </div>
            </div>
          </form>
          <div class="header-logo-wrapper col-auto p-0">  
            <div class="logo-wrapper"> <a href="index.html"><img class="img-fluid for-light" src="{{ url_for('static', filename='images/logo/logo_dark.png') }}" alt="logo-light"><img class="img-fluid for-dark" src="{{ url_for('static', filename='images/logo/logo.png') }}" alt="logo-dark"></a></div>
            <div class="toggle-sidebar"> <i class="status_toggle middle sidebar-toggle" data-feather="align-center"></i></div>
          </div>
          <div class="left-header col-xxl-5 col-xl-6 col-lg-5 col-md-4 col-sm-3 p-0">
            <div> <a class="toggle-sidebar" href="#"> <i class="iconly-Category icli"> </i></a>
              <div class="d-flex align-items-center gap-2 ">
                <h4 class="f-w-600">{{ user_name }}</h4>
                <img class="mt-0" src="{{ url_for('static', filename='images/hand.gif') }}" alt="hand-gif">
              </div>
            </div>
            <div class="welcome-content d-xl-block d-none"><span class="text-truncate col-12">Here's what's happening with your course today. </span></div>
          </div>
          <div class="nav-right col-xxl-7 col-xl-6 col-md-7 col-8 pull-right right-header p-0 ms-auto">
            <ul class="nav-menus"> 
              <li class="d-md-block d-none"> 
                <div class="form search-form mb-0">
                  <div class="input-group"><span class="input-icon">
                      <svg>
                        <use href="{{ url_for('static', filename='svg/icon-sprite.svg#search-header') }}"></use>
                      </svg>
                      <input class="w-100" type="search" placeholder="Search"></span></div>
                </div>
              </li>
              <li class="d-md-none d-block"> 
                <div class="form search-form mb-0">
                  <div class="input-group"> <span class="input-show"> 
                      <svg id="searchIcon">
                        <use href="{{ url_for('static', filename='svg/icon-sprite.svg#search-header') }}"></use>
                      </svg>
                      <div id="searchInput">
                        <input type="search" placeholder="Search">
                      </div></span></div>
                </div>
              </li>
              <li class="profile-nav onhover-dropdown"> 
                <div class="media profile-media">
                    <img class="b-r-10" alt="">
                    <div class="media-body d-xxl-block d-none box-col-none">
                        <p class="mb-0 font-roboto">Instructor <i class="middle fa fa-angle-down"></i></p>
                    </div>
                </div>
                <ul class="profile-dropdown onhover-show-div">
                    <li><a href="#" id="myProfileLink"><i data-feather="user"></i><span>My Profile</span></a></li>
                    <li><a href="{{ url_for('auth.logout') }}"><i data-feather="log-out"></i><span>Log out</span></a></li>
                </ul>
              </li>
            </ul>
          </div>
          <script class="result-template" type="text/x-handlebars-template">
            <div class="ProfileCard u-cf">                        
            <div class="ProfileCard-avatar"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-airplay m-0"><path d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"></path><polygon points="12 15 17 21 7 21 12 15"></polygon></svg></div>
            <div class="ProfileCard-details"> 
            <div class="ProfileCard-realName">{{name}}</div>
            </div> 
            </div>
          </script>
          <script class="empty-template" type="text/x-handlebars-template"><div class="EmptyMessage">Your search turned up 0 results. This most likely means the backend is down, yikes!</div></script>
        </div>
      </div>
      <!-- Page Header Ends                               -->
      <!-- Page Body Start-->
      <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div class="sidebar-wrapper" data-layout="stroke-svg">
          <div class="logo-wrapper"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/1.png') }}" alt=""></a>
            <div class="back-btn"><i class="fa fa-angle-left"> </i></div>
            <div class="toggle-sidebar"><i class="status_toggle middle sidebar-toggle" data-feather="grid"> </i></div>
          </div>
          <div class="logo-icon-wrapper"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/logo-icon.png') }}" alt=""></a></div>
          <nav class="sidebar-main">
            <div class="left-arrow" id="left-arrow"><i data-feather="arrow-left"></i></div>
            <div id="sidebar-menu">
              <ul class="sidebar-links" id="simple-bar">
                <li class="back-btn">
                    <a href="index.html"><img class="img-fluid" src="#" alt=""></a>
                    <div class="mobile-back text-end"> <span>Back </span><i class="fa fa-angle-right ps-2" aria-hidden="true"></i></div>
                </li>
                <li class="sidebar-list">
                    <i class="fa fa-thumb-tack"></i>
                    <a class="sidebar-link sidebar-title" href="#">
                        <span>Course</span>
                    </a>
                    <ul class="sidebar-submenu">
                        <li>
                            <a href="#" id="addedCoursesTab" data-toggle="modal" data-target="#addedCourseModal">Added Courses</a>
                        </li>
                    </ul>
                </li>
              </ul>
              <div class="right-arrow" id="right-arrow"><i data-feather="arrow-right"></i></div>
            </div>
          </nav>
        </div>
        <!-- Page Sidebar Ends-->
        <div class="page-body">
          <div class="container-fluid">
            <div class="page-title">
              <div class="row">
                <div class="col-6">
                  <h4>Instructor Dashboard</h4>
                </div>
                <div class="col-6">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">                                       
                        <svg class="stroke-icon">
                          <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-home') }}"></use>
                        </svg></a></li>
                    <li class="breadcrumb-item">Course</li>
                    
                  </ol>
                </div>
              </div>
            </div>
          </div>
          <!-- Container-fluid starts-->
          <div class="container-fluid"> 
            <div class="row">
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-header">
                    <h4>Add Course </h4>
                    <p class="mt-1 f-m-light"></p>
                  </div>
                  <div class="card-body">
                    <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#addCourseModal">Add New Course</button>
                    <div class="modal fade" id="addCourseModal" tabindex="-1" role="dialog" aria-labelledby="addCourseModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="addCourseModalLabel">Add New Course</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            <form id="addCourseForm" novalidate>
                              <div class="mb-3">
                                <label for="courseName" class="form-label">Course Name</label>
                                <input type="text" class="form-control" id="courseName" required 
                                       placeholder="Enter course name" minlength="3" maxlength="50">
                                <div class="invalid-feedback">
                                    Course name must be between 3 and 50 characters
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseDescription" class="form-label">Course Description</label>
                                <textarea class="form-control" id="courseDescription" rows="3" required
                                        placeholder="Enter course description" minlength="10" maxlength="500"></textarea>
                                <div class="invalid-feedback">
                                    Description must be between 10 and 500 characters
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseLevel" class="form-label">Course Level</label>
                                <select class="form-control" id="courseLevel" required>
                                    <option value="">Select Level</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a course level
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseDuration" class="form-label">Course Duration</label>
                                <input type="text" class="form-control" id="courseDuration" required
                                       placeholder="e.g., 2 weeks, 30 hours">
                                <div class="invalid-feedback">
                                    Please enter a valid duration (e.g., 2 weeks, 30 hours)
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseLink" class="form-label">Course Link</label>
                                <input type="url" class="form-control" id="courseLink" required
                                       placeholder="Enter course link">
                                <div class="invalid-feedback">
                                    Please enter a valid URL
                                </div>
                              </div>
                              <div class="mb-3">
                                <label for="courseStatus" class="form-label">Status</label>
                                <select class="form-control" id="courseStatus" required>
                                    <option value="">Select Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a status
                                </div>
                              </div>
                            </form>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="saveCourse">Save Course</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Container-fluid Ends-->
        </div>
        <!-- footer start-->
        <footer class="footer">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-12 footer-copyright text-center">
                <p class="mb-0">Copyright 2024 © DCEE </p>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <!-- latest jquery-->
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <!-- Bootstrap js-->
    <script src="{{ url_for('static', filename='js/bootstrap/bootstrap.bundle.min.js') }}"></script>
    <!-- feather icon js-->
    <script src="{{ url_for('static', filename='js/icons/feather-icon/feather.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/icons/feather-icon/feather-icon.js') }}"></script>
    <!-- scrollbar js-->
    <script src="{{ url_for('static', filename='js/scrollbar/simplebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/scrollbar/custom.js') }}"></script>
    <!-- Sidebar jquery-->
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
    <!-- Plugins JS start-->
    <script src="{{ url_for('static', filename='js/sidebar-menu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar-pin.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick/slick.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick/slick.js') }}"></script>
    <script src="{{ url_for('static', filename='js/header-slick.js') }}"></script>
    <!-- calendar js-->
    <script src="{{ url_for('static', filename='js/height-equal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tooltip-init.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modalpage/validation-modal.js') }}"></script>
    <!-- Plugins JS Ends-->
    <!-- Theme js-->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme-customizer/customizer.js') }}"></script>
    <!-- Added Courses Modal -->
    <div class="modal fade" id="addedCourseModal" tabindex="-1" role="dialog" aria-labelledby="addedCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addedCourseModalLabel">Added Courses</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Description</th>
                                <th>Level</th>
                                <th>Duration</th>
                                <th>Course Link</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="addedCoursesList">
                            <!-- Courses will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            // Predefined valid course categories/keywords
            const validCourseKeywords = [
                'marketing', 'digital marketing', 'e commerce', 'web development', 
                'python', 'java', 'javascript', 'react', 'angular', 'vue', 
                'node', 'php', 'html', 'css', 'bootstrap', 'jquery', 
                'mongodb', 'mysql', 'postgresql', 'database', 'cloud computing',
                'aws', 'azure', 'google cloud', 'devops', 'machine learning',
                'artificial intelligence', 'data science', 'blockchain',
                'cyber security', 'networking', 'business', 'management',
                'finance', 'accounting', 'human resources', 'sales'
            ];

            function validateInput(input, validator, errorMsg) {
                const value = input.val().trim();
                const isValid = validator(value);
                input.toggleClass('is-invalid', !isValid);
                input.toggleClass('is-valid', isValid);
                input.siblings('.invalid-feedback').text(errorMsg);
                return isValid;
            }

            // Course name validation
            function isValidCourseName(name) {
                name = name.toLowerCase();
                return validCourseKeywords.some(keyword => 
                    name.includes(keyword) || 
                    keyword.includes(name)
                );
            }

            // Description validation - simplified
            function isValidDescription(description) {
                // Only check for minimum length and proper sentence structure
                return description.length >= 20 && 
                       /^[A-Z].*[.!?]$/.test(description);
            }

            // Real-time validation
            $('#courseName').on('input', function() {
                validateInput($(this), 
                    isValidCourseName,
                    'Please enter a valid course name (e.g., Web Development, Digital Marketing, Python Programming)'
                );
            });

            $('#courseDescription').on('input', function() {
                validateInput($(this), 
                    isValidDescription,
                    'Description must be at least 20 characters, start with a capital letter, and end with proper punctuation.'
                );
            });

            // Form submission validation
            $('#saveCourse').on('click', function() {
                const form = $('#addCourseForm')[0];
                form.classList.add('was-validated');

                const name = $('#courseName').val().trim();
                const description = $('#courseDescription').val().trim();
                const level = $('#courseLevel').val();
                const duration = $('#courseDuration').val().trim();
                const course_link = $('#courseLink').val().trim();
                const status = $('#courseStatus').val();

                // Validate all fields
                let isValid = true;
                isValid &= validateInput($('#courseName'), 
                    isValidCourseName,
                    'Invalid course name'
                );
                isValid &= validateInput($('#courseDescription'), 
                    isValidDescription,
                    'Invalid description'
                );
                isValid &= validateInput($('#courseDuration'), 
                    value => /^[0-9]+\s*(hours?|days?|weeks?|months?)$/i.test(value), 
                    'Invalid duration'
                );
                isValid &= validateInput($('#courseLink'), 
                    value => /^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\/?$/.test(value), 
                    'Invalid URL'
                );
                isValid &= !!level;
                isValid &= !!status;

                if (!isValid) {
                    return;
                }

                // Submit form if validation passes
                const courseData = {
                    name: name,
                    description: description,
                    level: level,
                    duration: duration,
                    course_link: course_link,
                    status: status
                };

                $.ajax({
                    url: "{{ url_for('instructor.add_course') }}",
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(courseData),
                    success: function(response) {
                        if (response.success) {
                            alert('Course added successfully');
                            $('#addCourseModal').modal('hide');
                            form.reset();
                            form.classList.remove('was-validated');
                            $('.form-control').removeClass('is-valid is-invalid');
                            loadCourses();
                        } else {
                            alert('Failed to add course: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while adding the course');
                    }
                });
            });

            // Reset form when modal is closed
            $('#addCourseModal').on('hidden.bs.modal', function() {
                const form = $('#addCourseForm')[0];
                form.reset();
                form.classList.remove('was-validated');
                $('.form-control').removeClass('is-valid is-invalid');
            });

            function loadCourses() {
                $.ajax({
                    url: "{{ url_for('instructor.get_courses') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#addedCoursesList').empty();
                            response.data.forEach(course => {
                                $('#addedCoursesList').append(`
                                    <tr>
                                        <td>${course.name}</td>
                                        <td>${course.description}</td>
                                        <td>${course.level}</td>
                                        <td>${course.duration}</td>
                                        <td><a href="${course.course_link}" target="_blank">View Course</a></td>
                                        <td>${course.status}</td>
                                    </tr>
                                `);
                            });
                        } else {
                            alert('Failed to fetch courses: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while fetching courses');
                    }
                });
            }

            // Load courses when clicking Added Courses tab
            $('#addedCoursesTab').on('click', function() {
                loadCourses();
                $('#addedCourseModal').modal('show');
            });

            function loadProfileData() {
                $.ajax({
                    url: "{{ url_for('instructor.get_profile') }}",
                    type: 'GET',
                    success: function(response) {
                        if (response.success) {
                            $('#instructorName').val(response.data.name);
                            $('#instructorEmail').val(response.data.email);
                            $('#profileModal').modal('show');
                        } else {
                            alert('Failed to fetch profile data: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                        alert('An error occurred while fetching profile data');
                    }
                });
            }

            $('#myProfileLink').on('click', function(e) {
                e.preventDefault();
                loadProfileData();
            });
        });
    </script>
    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profileModalLabel">Instructor Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="mb-3">
                            <label for="instructorName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="instructorName" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="instructorEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="instructorEmail" readonly>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>