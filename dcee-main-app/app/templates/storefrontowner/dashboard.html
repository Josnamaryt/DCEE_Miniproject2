<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Riho admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Riho admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <title>Storefront Owner Dashboard</title>
    <!-- Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/font-awesome.css') }}">
    <!-- ico-font-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/icofont.css') }}">
    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/themify.css') }}">
    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/flag-icon.css') }}">
    <!-- Feather icon-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/feather-icon.css') }}">
    <!-- Plugins css start-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/slick.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/slick-theme.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/scrollbar.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/quill.snow.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/animate.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/intltelinput.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/tagify.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/flatpickr/flatpickr.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/dropzone.css') }}">
    <!-- Plugins css Ends-->
    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/vendors/bootstrap.css') }}">
    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link id="color" rel="stylesheet" href="{{ url_for('static', filename='css/color-1.css') }}" media="screen">
    <!-- Responsive css-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/responsive.css') }}">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body> 
    <!-- loader starts-->
    <div class="loader-wrapper">
      <div class="loader"> 
        <div class="loader4"></div>
      </div>
    </div>
    <!-- loader ends-->
    <!-- tap on top starts-->
    <div class="tap-top"><i data-feather="chevrons-up"></i></div>
    <!-- tap on tap ends-->
    <!-- page-wrapper Start-->
    <div class="page-wrapper compact-wrapper" id="pageWrapper">
      <!-- Page Header Start-->
      <div class="page-header">
        <div class="header-wrapper row m-0">
          <form class="form-inline search-full col" action="#" method="get">
            <div class="form-group w-100">
              <div class="Typeahead Typeahead--twitterUsers">
                <div class="u-posRelative"> 
                  <input class="demo-input Typeahead-input form-control-plaintext w-100" type="text" placeholder="Search Riho .." name="q" title="" autofocus="">
                  <div class="spinner-border Typeahead-spinner" role="status"><span class="sr-only">Loading... </span></div><i class="close-search" data-feather="x"></i>
                </div>
                <div class="Typeahead-menu"> </div>
              </div>
            </div>
          </form>
          <div class="header-logo-wrapper col-auto p-0">  
            <div class="logo-wrapper"> <a href="index.html"><img class="img-fluid for-light" src="{{ url_for('static', filename='images/logo/1.png') }}" alt="logo-light"><img class="img-fluid for-dark" src="{{ url_for('static', filename='images/logo/1.png') }}" alt="logo-dark"></a></div>
            <div class="toggle-sidebar"> <i class="status_toggle middle sidebar-toggle" data-feather="align-center"></i></div>
          </div>
          <div class="left-header col-xxl-5 col-xl-6 col-lg-5 col-md-4 col-sm-3 p-0">
            <div> <a class="toggle-sidebar" href="#"> <i class="iconly-Category icli"> </i></a>
              <div class="d-flex align-items-center gap-2 ">
                <h4 class="f-w-600">Welcome {{ current_user_dict.first_name }} {{ current_user_dict.last_name }}</h4><img class="mt-0" src="{{ url_for('static', filename='images/hand.gif') }}" alt="hand-gif">
              </div>
            </div>
            <div class="welcome-content d-xl-block d-none"><span class="text-truncate col-12">Here's what's happening with your store today. </span></div>
          </div>
          <div class="nav-right col-xxl-7 col-xl-6 col-md-7 col-8 pull-right right-header p-0 ms-auto">
            <ul class="nav-menus"> 
              
              <li> 
                <div class="mode"><i class="moon" data-feather="moon"> </i></div>
              </li>
              
              <li class="profile-nav onhover-dropdown"> 
                <div class="media profile-media"><img class="b-r-10" src="" alt="">
                  <div class="media-body d-xxl-block d-none">
                    <div class="d-flex align-items-center gap-2"> <span>{{ current_user_dict.first_name }} {{ current_user_dict.last_name }} </span><i class="middle fa fa-angle-down"> </i></div>
                    <p class="mb-0 font-roboto">Storefront Owner</p>
                  </div>
                </div>
                <ul class="profile-dropdown onhover-show-div">
                  <li><a href="#" id="myProfileLink"><i data-feather="user"></i><span>My Profile</span></a></li>
                  <li><a href="letter-box.html"><i data-feather="mail"></i><span>Inbox</span></a></li>
                  <li> <a href="edit-profile.html"> <i data-feather="settings"></i><span>Settings</span></a></li>
                  <li><a class="btn btn-pill btn-outline-primary btn-sm" href="{{ url_for('auth.login') }}">Log Out</a></li>
                </ul>
              </li>
            </ul>
          </div>
          <script class="result-template" type="text/x-handlebars-template">
            <div class="ProfileCard u-cf">                        
            <div class="ProfileCard-avatar"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-airplay m-0"><path d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"></path><polygon points="12 15 17 21 7 21 12 15"></polygon></svg></div>
            <div class="ProfileCard-details"> 
            <div class="ProfileCard-realName">{{name}}</div>
            </div> 
            </div>
          </script>
          <script class="empty-template" type="text/x-handlebars-template"><div class="EmptyMessage">Your search turned up 0 results. This most likely means the backend is down, yikes!</div></script>
        </div>
      </div>
      <!-- Page Header Ends                              -->
      <!-- Page Body Start-->
      <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div class="sidebar-wrapper" data-layout="stroke-svg">
          <div class="logo-wrapper"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/1.png') }}" alt=""></a>
            <div class="back-btn"><i class="fa fa-angle-left"> </i></div>
            <div class="toggle-sidebar"><i class="status_toggle middle sidebar-toggle" data-feather="grid"> </i></div>
          </div>
          <div class="logo-icon-wrapper"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/logo-icon.png') }}" alt=""></a></div>
          <nav class="sidebar-main">
            <div class="left-arrow" id="left-arrow"><i data-feather="arrow-left"></i></div>
            <div id="sidebar-menu">
              <ul class="sidebar-links" id="simple-bar">
                <li class="back-btn"><a href="index.html"><img class="img-fluid" src="{{ url_for('static', filename='images/logo/logo-icon.png') }}" alt=""></a>
                  <div class="mobile-back text-end"> <span>Back </span><i class="fa fa-angle-right ps-2" aria-hidden="true"></i></div>
                </li>
                <li class="pin-title sidebar-main-title">
                  <div> 
                    <h6>Pinned</h6>
                  </div>
                </li>
                
                <li class="sidebar-main-title">
                  <div>
                    <h6 class="lan-8">Applications</h6>
                  </div>
                </li>
                <li class="sidebar-list">
                  <a class="sidebar-link sidebar-title" href="#" data-bs-toggle="modal" data-bs-target="#storeRegistrationModal">
                    <svg class="stroke-icon">
                      <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-ecommerce') }}"></use>
                    </svg>
                    <svg class="fill-icon">
                      <use href="{{ url_for('static', filename='svg/icon-sprite.svg#fill-ecommerce') }}"></use>
                    </svg>
                    <span>Register Store</span>
                  </a>
                </li>
                <li class="sidebar-list">
                  <a class="sidebar-link sidebar-title" href="{{ url_for('storeowner.get_stores') }}">
                    <svg class="stroke-icon">
                      <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-ecommerce') }}"></use>
                    </svg>
                    <svg class="fill-icon">
                      <use href="{{ url_for('static', filename='svg/icon-sprite.svg#fill-ecommerce') }}"></use>
                    </svg>
                    <span>Store Details</span>
                  </a>
                </li>
                <li class="sidebar-list">
                  <a class="sidebar-link sidebar-title" href="#" data-bs-toggle="modal" data-bs-target="#productRegistrationModal">
                    <svg class="stroke-icon">
                      <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-ecommerce') }}"></use>
                    </svg>
                    <svg class="fill-icon">
                      <use href="{{ url_for('static', filename='svg/icon-sprite.svg#fill-ecommerce') }}"></use>
                    </svg>
                    <span>Register Product</span>
                  </a>
                </li>
                <li class="sidebar-list">
                  <a class="sidebar-link sidebar-title" href="{{ url_for('storeowner.get_products') }}">
                    <svg class="stroke-icon">
                      <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-ecommerce') }}"></use>
                    </svg>
                    <svg class="fill-icon">
                      <use href="{{ url_for('static', filename='svg/icon-sprite.svg#fill-ecommerce') }}"></use>
                    </svg>
                    <span>Product Details</span>
                  </a>
                </li>
                <div class="right-arrow" id="right-arrow"><i data-feather="arrow-right"></i></div>
              </div>
            </nav>
          </div>
          <!-- Page Sidebar Ends-->
          <div class="page-body">
            <div class="container-fluid">
              <div class="page-title">
                <div class="row">
                  <div class="col-6">
                    <h4>Dashboard</h4>
                  </div>
                  <div class="col-6">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item"><a href="index.html">
                        <svg class="stroke-icon">
                          <use href="{{ url_for('static', filename='svg/icon-sprite.svg#stroke-home') }}"></use>
                        </svg></a>
                      </li>
                      <li class="breadcrumb-item">Dashboard</li>
                      <li class="breadcrumb-item active">Product Overview</li>
                    </ol>
                  </div>
                </div>
              </div>
            </div>
            <!-- Container-fluid starts-->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Product Overview</h5>
                            </div>
                            <div class="card-body">
                                <div id="productOverview">
                                    <!-- Product overview will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Container-fluid Ends-->
          </div>
    <!-- Store Details Modal -->
    <div class="modal fade storeDetailsModal" id="storeDetailsModal" tabindex="-1" aria-labelledby="storeDetailsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-scrollable">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="storeDetailsModalLabel">Store Details</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  <div class="container mt-5">
                      <h2>Store Details</h2>
                      <table id="storeTable" class="table table-striped table-bordered">
                          <thead>
                              <tr>
                                  <th>Store Name</th>
                                  <th>Store Type</th>
                                  <th>Store Address</th>
                                  <th>Store GSTIN</th>
                                  <th>Store Owner ID</th>
                                  <th>Store Established Date</th>
                              </tr>
                          </thead>
                          <tbody>
                              <!-- Data will be populated here by DataTables -->
                          </tbody>
                      </table>
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
          </div>
      </div>
  </div>
<!-- End Store Details Modal -->
<!-- Modal for Product Registration -->
<div class="modal fade" id="productRegistrationModal" tabindex="-1" aria-labelledby="productRegistrationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productRegistrationModalLabel">Product Registration</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="productRegistrationForm" action="{{ url_for('storeowner.register_product') }}" method="post" enctype="multipart/form-data" class="row g-2">
          <label class="form-label col-12 m-0" for="product_name">Product Name <span class="txt-danger">*</span></label>
          <div class="col-12 custom-input">
            <input class="form-control" id="product_name" name="product_name" type="text" required>
            <div class="valid-feedback">Looks good!</div>
            <div class="invalid-feedback"></div>
          </div>

          <label class="form-label col-12 m-0" for="product_price">Product Price <span class="txt-danger">*</span></label>
          <div class="col-12 custom-input">
            <input class="form-control" id="product_price" name="product_price" type="number" step="0.01" required>
            <div class="valid-feedback">Looks good!</div>
            <div class="invalid-feedback"></div>
          </div>

          <label class="form-label col-12 m-0" for="product_status">Product Status <span class="txt-danger">*</span></label>
          <div class="col-12 custom-input">
            <select class="form-control" id="product_status" name="product_status" required>
              <option value="">Select Status</option>
              <option value="available">Available</option>
              <option value="out_of_stock">Out of Stock</option>
              <option value="discontinued">Discontinued</option>
            </select>
            <div class="valid-feedback">Looks good!</div>
            <div class="invalid-feedback"></div>
          </div>

          <label class="form-label col-12 m-0" for="product_image">Product Image <span class="txt-danger">*</span></label>
          <div class="col-12 custom-input">
            <input class="form-control" id="product_image" name="product_image" type="file" accept="image/*" required>
            <div class="valid-feedback">Looks good!</div>
            <div class="invalid-feedback"></div>
          </div>

          <label class="form-label col-12 m-0" for="product_quantity">Product Quantity <span class="txt-danger">*</span></label>
          <div class="col-12 custom-input">
            <input class="form-control" id="product_quantity" name="product_quantity" type="number" required>
            <div class="valid-feedback">Looks good!</div>
            <div class="invalid-feedback"></div>
          </div>

          <label class="form-label col-12 m-0" for="product_add_date">Product Add Date <span class="txt-danger">*</span></label>
          <div class="col-12 custom-input">
            <input class="form-control" id="product_add_date" name="product_add_date" type="date" required>
            <div class="valid-feedback">Looks good!</div>
            <div class="invalid-feedback"></div>
          </div>

          <div class="col-12">
            <button type="submit" class="btn btn-primary">Register Product</button>
          </div>
        </form>
        <div id="productRegistrationMessage" style="display: none;"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- End Product Registration Modal -->
 
          <!-- footer start-->
          <footer class="footer">
            <div class="container-fluid">
              <div class="row">
                <div class="col-md-12 footer-copyright text-center">
                  <p class="mb-0">Copyright 2024 © DCEE  </p>
                </div>
              </div>
            </div>
          </footer>
        </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
      
      <!-- DataTables JS -->
      <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
      <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
      <script>
        $(document).ready(function() {
            let storeTable;
    
            function initDataTable() {
                if ($.fn.DataTable.isDataTable('#storeTable')) {
                    storeTable.ajax.reload();
                } else {
                    storeTable = $('#storeTable').DataTable({
                        "ajax": {
                            "url": "{{ url_for('storeowner.get_stores') }}",
                            "dataSrc": "",
                            "error": function(xhr, error, thrown) {
                                console.error('Error loading store data:', error);
                            }
                        },
                        "columns": [
                            { "data": "store_name" },
                            { "data": "store_type" },
                            { "data": "store_address" },
                            { "data": "store_gstin" },
                            { "data": "store_owner_id" },
                            { "data": "store_established_date" }
                        ],
                        "initComplete": function(settings, json) {
                            console.log('DataTable initialization complete');
                            console.log('Received data:', json);
                        }
                    });
                }
            }
    
            $('#storeDetailsModal').on('shown.bs.modal', function() {
                console.log('Store Details modal shown, initializing DataTable...');
                initDataTable();
            });
        });
        </script>
      <!-- Store Details Modal JS -->
      <script>
        $(document).ready(function() {
          console.log('Document ready');
          console.log('jQuery version:', $.fn.jquery);
          console.log('DataTables available:', typeof $.fn.DataTable === 'function');

          // Function to initialize DataTable
          function initDataTable() {
            if (typeof $.fn.DataTable === 'function') {
              console.log('DataTables is loaded');
              if (!$.fn.DataTable.isDataTable('#storeTable')) {
                $('#storeTable').DataTable({
                  "ajax": {
                    "url": "{{ url_for('storeowner.get_stores') }}",
                    "dataSrc": function(json) {
                      console.log('Processing store data...');
                      console.log('Received data:', json);
                      return json;
                    }
                  },
                  "columns": [
                    { "data": "store_name" },
                    { "data": "store_type" },
                    { "data": "store_address" },
                    { "data": "store_gstin" },
                    { "data": "store_established_date" }
                  ],
                  "initComplete": function(settings, json) {
                    console.log('DataTable initialization complete');
                  }
                });
              } else {
                $('#storeTable').DataTable().ajax.reload();
              }
            } else {
              console.error('DataTables is not loaded');
            }
          }

          // Try to initialize DataTable when the modal is shown
          $('.storeDetailsModal').on('shown.bs.modal', function() {
            console.log('Store Details modal shown, initializing DataTable...');
            initDataTable();
          });

          // If DataTables is not immediately available, wait for it
          if (typeof $.fn.DataTable !== 'function') {
            var checkDataTables = setInterval(function() {
              if (typeof $.fn.DataTable === 'function') {
                clearInterval(checkDataTables);
                console.log('DataTables is now available');
                initDataTable();
              }
            }, 100);
          }
        });
      </script>
      <!-- End Store Details Modal JS -->
      <!-- Product Registration Modal JS -->
      <script>
        $(document).ready(function() {
          // Real-time validation for product registration
          $('#product_name, #product_price, #product_status, #product_image, #product_quantity, #product_add_date').on('input change', function() {
            validateProductField($(this));
          });

          $('#productRegistrationForm').on('submit', function(e) {
            e.preventDefault();
            var form = $(this)[0];
            var formData = new FormData(form);

            // Final validation before submission
            var isValid = validateProductForm();

            if (isValid) {
              $.ajax({
                type: 'POST',
                url: form.action,
                data: formData,
                processData: false,
                contentType: false,
                success: function(data) {
                  if (data.success) {
                    $('#productRegistrationMessage').html('<div class="alert alert-success">' + data.message + '</div>');
                    $('#productRegistrationMessage').show();
                    form.reset(); // Reset the form
                  } else {
                    $('#productRegistrationMessage').html('<div class="alert alert-danger">' + data.message + '</div>');
                    $('#productRegistrationMessage').show();
                  }
                },
                error: function() {
                  $('#productRegistrationMessage').html('<div class="alert alert-danger">An error occurred. Please try again.</div>');
                  $('#productRegistrationMessage').show();
                }
              });
            }
          });

          function validateProductField($field) {
            var fieldId = $field.attr('id');
            var value = $field.val();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
              case 'product_name':
                if (value.trim() === '') {
                  isValid = false;
                  errorMessage = 'Product name is required';
                }
                break;
              case 'product_price':
                if (isNaN(value) || parseFloat(value) <= 0) {
                  isValid = false;
                  errorMessage = 'Price must be a positive number';
                }
                break;
              case 'product_status':
                if (value === '') {
                  isValid = false;
                  errorMessage = 'Please select a product status';
                }
                break;
              case 'product_image':
                if ($field[0].files.length === 0) {
                  isValid = false;
                  errorMessage = 'Please select an image file';
                }
                break;
              case 'product_quantity':
                if (isNaN(value) || parseInt(value) < 0) {
                  isValid = false;
                  errorMessage = 'Quantity must be a non-negative integer';
                }
                break;
              case 'product_add_date':
                if (value === '') {
                  isValid = false;
                  errorMessage = 'Please select a date';
                }
                break;
            }

            if (isValid) {
              $field.removeClass('is-invalid').addClass('is-valid');
              $field.siblings('.invalid-feedback').hide();
            } else {
              $field.removeClass('is-valid').addClass('is-invalid');
              $field.siblings('.invalid-feedback').text(errorMessage).show();
            }

            return isValid;
          }

          function validateProductForm() {
            var isValid = true;
            $('#productRegistrationForm input[required], #productRegistrationForm select[required]').each(function() {
              if (!validateProductField($(this))) {
                isValid = false;
              }
            });
            return isValid;
          }
        });
      </script>
      <!-- End Product Registration Modal JS -->
       
      <!-- latest jquery-->
      <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
      <!-- Bootstrap js-->
      <script src="{{ url_for('static', filename='js/bootstrap/bootstrap.bundle.min.js') }}"></script>
      <!-- feather icon js-->
      <script src="{{ url_for('static', filename='js/icons/feather-icon/feather.min.js') }}"></script>
      <script src="{{ url_for('static', filename='js/icons/feather-icon/feather-icon.js') }}"></script>
      <!-- scrollbar js-->
      <script src="{{ url_for('static', filename='js/scrollbar/simplebar.js') }}"></script>
      <script src="{{ url_for('static', filename='js/scrollbar/custom.js') }}"></script>
      <!-- Sidebar jquery-->
      <script src="{{ url_for('static', filename='js/config.js') }}"></script>
      <!-- Plugins JS start-->
      <script src="{{ url_for('static', filename='js/sidebar-menu.js') }}"></script>
      <script src="{{ url_for('static', filename='js/sidebar-pin.js') }}"></script>
      <script src="{{ url_for('static', filename='js/slick/slick.min.js') }}"></script>
      <script src="{{ url_for('static', filename='js/slick/slick.js') }}"></script>
      <script src="{{ url_for('static', filename='js/header-slick.js') }}"></script>
      <!-- calendar js-->
      <script src="{{ url_for('static', filename='js/flat-pickr/flatpickr.js') }}"></script>
      <script src="{{ url_for('static', filename='js/flat-pickr/custom-flatpickr.js') }}"></script>
      <script src="{{ url_for('static', filename='js/dropzone/dropzone.js') }}"></script>
      <script src="{{ url_for('static', filename='js/dropzone/dropzone-script.js') }}"></script>
      <script src="{{ url_for('static', filename='js/select2/tagify.js') }}"></script>
      <script src="{{ url_for('static', filename='js/select2/tagify.polyfills.min.js') }}"></script>
      <script src="{{ url_for('static', filename='js/select2/intltelinput.min.js') }}"></script>
      <script src="{{ url_for('static', filename='js/add-product/select4-custom.js') }}"></script>
      <script src="{{ url_for('static', filename='js/editors/quill.js') }}"></script>
      <script src="{{ url_for('static', filename='js/custom-add-product.js') }}"></script>
      <script src="{{ url_for('static', filename='js/height-equal.js') }}"></script>
      <script src="{{ url_for('static', filename='js/tooltip-init.js') }}"></script>
      <!-- Plugins JS Ends-->
      <!-- Theme js-->
      <script src="{{ url_for('static', filename='js/script.js') }}"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.min.js"></script>
<!-- End Product Details Modal JS -->

<!-- Store Registration Form AJAX Submission -->
<script>
$(document).ready(function() {
    // Real-time validation
    $('#store_name, #store_type, #store_gstin').on('input', function() {
        validateField($(this));
    });

    $('#storeRegistrationForm').on('submit', function(e) {
        e.preventDefault();
        var form = $(this);
        var url = form.attr('action');

        // Final validation before submission
        var isValid = validateForm();

        if (isValid) {
            $.ajax({
                type: 'POST',
                url: url,
                data: form.serialize(),
                success: function(data) {
                    if (data.success) {
                        $('#registrationMessage').html('<div class="alert alert-success">' + data.message + '</div>');
                        $('#registrationMessage').show();
                        form[0].reset(); // Reset the form
                    } else {
                        $('#registrationMessage').html('<div class="alert alert-danger">' + data.message + '</div>');
                        $('#registrationMessage').show();
                    }
                },
                error: function() {
                    $('#registrationMessage').html('<div class="alert alert-danger">An error occurred. Please try again.</div>');
                    $('#registrationMessage').show();
                }
            });
        }
    });

    function validateField($field) {
        var fieldId = $field.attr('id');
        var value = $field.val();
        var isValid = true;
        var errorMessage = '';

        switch(fieldId) {
            case 'store_name':
            case 'store_type':
                if (!/^[A-Za-z\s]*$/.test(value)) {
                    isValid = false;
                    errorMessage = 'Should not contain numbers';
                }
                break;
            case 'store_gstin':
                if (!/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/.test(value)) {
                    isValid = false;
                    errorMessage = 'Invalid GSTIN format. Should be like: 22AAAAA0000A1Z5';
                }
                break;
        }

        if (isValid) {
            $field.removeClass('is-invalid').addClass('is-valid');
            $field.siblings('.invalid-feedback').hide();
        } else {
            $field.removeClass('is-valid').addClass('is-invalid');
            $field.siblings('.invalid-feedback').text(errorMessage).show();
        }

        return isValid;
    }

    function validateForm() {
        var isValid = true;
        $('#storeRegistrationForm input[required]').each(function() {
            if (!validateField($(this))) {
                isValid = false;
            }
        });
        return isValid;
    }
});
</script>
<!-- End Store Registration Form AJAX Submission -->

<!-- Add this modal for store registration -->
<div class="modal fade" id="storeRegistrationModal" tabindex="-1" aria-labelledby="storeRegistrationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="storeRegistrationModalLabel">Store Registration</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="storeRegistrationForm" action="{{ url_for('storeowner.register_store') }}" method="post" class="row g-2">
                    <label class="form-label col-12 m-0" for="store_name">Store Name <span class="txt-danger">*</span></label>
                    <div class="col-12 custom-input">
                        <input class="form-control" id="store_name" name="store_name" type="text" required>
                        <div class="valid-feedback">Looks good!</div>
                        <div class="invalid-feedback"></div>
                    </div>
                
                    <label class="form-label col-12 m-0" for="store_type">Store Type <span class="txt-danger">*</span></label>
                    <div class="col-12 custom-input">
                        <input class="form-control" id="store_type" name="store_type" type="text" required>
                        <div class="valid-feedback">Looks good!</div>
                        <div class="invalid-feedback"></div>
                    </div>
                
                    <label class="form-label col-12 m-0" for="store_address">Store Address <span class="txt-danger">*</span></label>
                    <div class="col-12 custom-input">
                        <textarea class="form-control" id="store_address" name="store_address" required></textarea>
                        <div class="valid-feedback">Looks good!</div>
                        <div class="invalid-feedback">Store address is required.</div>
                    </div>
                    <label class="form-label col-12 m-0" for="store_gstin">Store GSTIN <span class="txt-danger">*</span></label>
                    <div class="col-12 custom-input">
                      <input class="form-control" id="store_gstin" name="store_gstin" type="text" required>
                      <div class="valid-feedback">Looks good!</div>
                      <div class="invalid-feedback"></div>
                  </div>
              
                  <label class="form-label col-12 m-0" for="store_established_date">Store Established Date <span class="txt-danger">*</span></label>
                  <div class="col-12 custom-input">
                      <input class="form-control" id="store_established_date" name="store_established_date" type="date" required>
                      <div class="valid-feedback">Looks good!</div>
                      <div class="invalid-feedback">Store established date is required.</div>
                  </div>
              
                  <div class="col-12">
                      <button type="submit" class="btn btn-primary">Register Store</button>
                  </div>
                </form>
                <div id="registrationMessage" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
  // Load product overview when the page loads
  loadProductOverview();

  function loadProductOverview() {
    $.ajax({
      url: "{{ url_for('storeowner.get_product_overview') }}",
      type: 'GET',
      success: function(response) {
        $('#productOverview').html(response);
      },
      error: function(xhr, status, error) {
        console.error('Error loading product overview:', error);
        $('#productOverview').html('<p>Error loading product overview. Please try again later.</p>');
      }
    });
  }

  function showProductDetails() {
    // Hide the product overview
    $('#productOverview').hide();
    
    // Show the existing product details section
    $('#productDetails').show();
    
    // If you need to refresh the product details, you can add that logic here
    // For example, you might call a function to reload the product data
    // reloadProductDetails();
  }
});
</script>

<!-- User Profile Modal -->
<div class="modal fade" id="userProfileModal" tabindex="-1" aria-labelledby="userProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="userProfileModalLabel">My Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong>First Name:</strong> <span id="userFirstName"></span></p>
        <p><strong>Email:</strong> <span id="userEmail"></span></p>
        <p><strong>Phone Number:</strong> <span id="userPhone"></span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="editProfileBtn">Edit Profile</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editProfileForm">
          <div class="mb-3">
            <label for="editFirstName" class="form-label">First Name</label>
            <input type="text" class="form-control" id="editFirstName" name="first_name" required>
          </div>
          <div class="mb-3">
            <label for="editEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="editEmail" name="email" required>
          </div>
          <div class="mb-3">
            <label for="editPhone" class="form-label">Phone Number</label>
            <input type="tel" class="form-control" id="editPhone" name="phone" required>
          </div>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
  function loadUserProfile() {
    $.ajax({
      url: "{{ url_for('storeowner.get_profile') }}",
      type: 'GET',
      success: function(response) {
        if (response.success) {
          $('#userFirstName').text(response.data.first_name);
          $('#userEmail').text(response.data.email);
          $('#userPhone').text(response.data.phone || 'Not available');
          
          // Populate edit form
          $('#editFirstName').val(response.data.first_name);
          $('#editEmail').val(response.data.email);
          $('#editPhone').val(response.data.phone || '');
        } else {
          alert('Error fetching user profile. Please try again later.');
        }
      },
      error: function() {
        alert('An error occurred while fetching profile data. Please try again.');
      }
    });
  }

  $('#myProfileLink').on('click', function(e) {
    e.preventDefault();
    loadUserProfile();
    $('#userProfileModal').modal('show');
  });

  $('#editProfileBtn').on('click', function() {
    $('#userProfileModal').modal('hide');
    $('#editProfileModal').modal('show');
  });

  $('#editProfileForm').on('submit', function(e) {
    e.preventDefault();
    var formData = $(this).serialize();
    $.ajax({
      url: "{{ url_for('storeowner.update_profile') }}",
      type: 'POST',
      data: formData,
      success: function(response) {
        if (response.success) {
          alert('Profile updated successfully');
          $('#editProfileModal').modal('hide');
          loadUserProfile();
          $('#userProfileModal').modal('show');
        } else {
          alert('Error updating profile: ' + response.message);
        }
      },
      error: function() {
        alert('An error occurred while updating the profile. Please try again.');
      }
    });
  });
});
</script>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editProfileForm">
          <div class="mb-3">
            <label for="editFirstName" class="form-label">First Name</label>
            <input type="text" class="form-control" id="editFirstName" name="first_name" required>
          </div>
          <div class="mb-3">
            <label for="editEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="editEmail" name="email" required>
          </div>
          <div class="mb-3">
            <label for="editPhone" class="form-label">Phone Number</label>
            <input type="tel" class="form-control" id="editPhone" name="phone" required>
          </div>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
  function loadUserProfile() {
    $.ajax({
      url: "{{ url_for('storeowner.get_profile') }}",
      type: 'GET',
      success: function(response) {
        if (response.success) {
          $('#userFirstName').text(response.data.first_name);
          $('#userEmail').text(response.data.email);
          $('#userPhone').text(response.data.phone || 'Not available');
          
          // Populate edit form
          $('#editFirstName').val(response.data.first_name);
          $('#editEmail').val(response.data.email);
          $('#editPhone').val(response.data.phone || '');
        } else {
          alert('Error fetching user profile. Please try again later.');
        }
      },
      error: function() {
        alert('An error occurred while fetching profile data. Please try again.');
      }
    });
  }

  $('#myProfileLink').on('click', function(e) {
    e.preventDefault();
    loadUserProfile();
    $('#userProfileModal').modal('show');
  });

  $('#editProfileBtn').on('click', function() {
    $('#userProfileModal').modal('hide');
    $('#editProfileModal').modal('show');
  });

  $('#editProfileForm').on('submit', function(e) {
    e.preventDefault();
    var formData = $(this).serialize();
    $.ajax({
      url: "{{ url_for('storeowner.update_profile') }}",
      type: 'POST',
      data: formData,
      success: function(response) {
        if (response.success) {
          alert('Profile updated successfully');
          $('#editProfileModal').modal('hide');
          loadUserProfile();
          $('#userProfileModal').modal('show');
        } else {
          alert('Error updating profile: ' + response.message);
        }
      },
      error: function() {
        alert('An error occurred while updating the profile. Please try again.');
      }
    });
  });
});
</script>

<script>
$(document).ready(function() {
  // Fetch and display user profile data when the modal is shown
  $('#userProfileModal').on('show.bs.modal', function(event) {
    var modal = $(this);
    $.ajax({
      url: "{{ url_for('storeowner.get_profile') }}",
      type: 'GET',
      success: function(response) {
        console.log("Profile response:", response);  // Add this line for debugging
        if (response.success) {
          modal.find('#userFirstName').text(response.data.first_name);
          modal.find('#userEmail').text(response.data.email);
          modal.find('#userGSTIN').text(response.data.gstin || 'Not available');  // Add fallback text
        } else {
          modal.find('.modal-body').html('<p>Error fetching user profile. Please try again later.</p>');
        }
      },
      error: function(xhr, status, error) {
        console.error('Error fetching user profile:', error);
        modal.find('.modal-body').html('<p>Error fetching user profile. Please try again later.</p>');
      }
    });
  });

  // Handle click on My Profile link
  $('#myProfileLink').on('click', function(e) {
    e.preventDefault();
    $('#userProfileModal').modal('show');
  });
});
</script>

    </body>
  </html>